<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bit√°cora Cultural - Panel de Administraci√≥n</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Biblioteca para visualizar PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
      /* RESET Y ESTILOS GENERALES */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Montserrat", sans-serif;
      }

      body {
        background: #f5f7fa;
        color: #333;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      /* HEADER */
      header {
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        color: white;
        padding: 20px 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
      }
      
#public-view header {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: 1000;
  margin-bottom: 1200px
}
#public-view > section:first-of-type {
  margin-top: 160px;
}
#public-view {
  padding-top: 30px;
}
@media (max-width: 1500px) {
  #public-view {
    padding-top: auto;
  }
}
@media (max-width: 768px) {
  #public-view {
    padding-top: auto;
  }
}

body.modal-open #public-view header {
  position: static;
}


      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .logo-image {
        height: 60px;
        max-width: 200px;
      }

      .logo-image img {
        height: 100%;
        max-height: 60px;
        object-fit: contain;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
      }

      .logo p {
        font-size: 14px;
        color: #ff6f61;
        font-style: italic;
      }

      nav ul {
        display: flex;
        list-style: none;
        gap: 25px;
      }

      nav a {
        color: white;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s;
        padding: 8px 15px;
        border-radius: 4px;
      }

      nav a:hover {
        color: #ff6f61;
        background: rgba(255, 255, 255, 0.1);
      }

      .admin-link {
        background: #ff6f61;
        color: white !important;
      }

      .admin-link:hover {
        background: #e55a50;
      }

      /* LOGIN */
      .login-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .login-form {
        background: white;
        padding: 40px;
        border-radius: 10px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .login-form h2 {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 10px;
      }

      .login-form p {
        text-align: center;
        color: #7f8c8d;
        margin-bottom: 30px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #2c3e50;
        font-weight: 500;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 16px;
      }

      .btn {
        display: inline-block;
        background: #ff6f61;
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        text-align: center;
      }

      .btn:hover {
        background: #e55a50;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 111, 97, 0.3);
      }

      .btn-large {
        padding: 15px 40px;
        font-size: 18px;
      }

      /* PANEL ADMIN */
      #admin-panel {
        display: none;
        min-height: 100vh;
        background: #f5f7fa;
      }

      .admin-header {
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        color: white;
        padding: 20px 0;
        margin-bottom: 30px;
      }

      .admin-nav {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      .tab-btn {
        background: #e9ecef;
        color: #495057;
        border: 2px solid #dee2e6;
        padding: 12px 25px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        font-size: 15px;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .tab-btn:hover {
        background: #dee2e6;
      }

      .tab-btn.active {
        background: #ff6f61;
        color: white;
        border-color: #ff6f61;
      }

      .admin-section {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        margin-bottom: 30px;
        display: none;
      }

      .admin-section.active {
        display: block;
        animation: fadeIn 0.5s ease;
      }
body.admin-mode #anteriores {
  display: none !important;
}

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .admin-section h3 {
        color: #2c3e50;
        font-size: 24px;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 3px solid #ff6f61;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      /* FORMULARIO AGREGAR REVISTA */
      .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }

      .form-row .form-group {
        flex: 1;
        margin-bottom: 0;
      }

      textarea {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 16px;
        min-height: 120px;
        resize: vertical;
      }

      /* INPUT DE ARCHIVOS */
      .file-input-container {
        position: relative;
        margin-bottom: 15px;
      }

      .file-input {
        width: 100%;
        padding: 12px 15px;
        border: 2px dashed #ddd;
        border-radius: 6px;
        background: #f9f9f9;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s;
      }

      .file-input:hover {
        border-color: #ff6f61;
        background: #fff9f8;
      }

      .file-input i {
        font-size: 24px;
        color: #ff6f61;
        margin-bottom: 10px;
        display: block;
      }

      .image-preview-container {
        margin-top: 15px;
        text-align: center;
      }

      .image-preview {
        max-width: 100%;
        max-height: 200px;
        border-radius: 6px;
        border: 2px solid #ddd;
        margin-top: 10px;
        display: none;
      }

      .image-preview.active {
        display: inline-block;
      }

      /* LISTA DE REVISTAS - ¬°ESTILOS MEJORADOS! */
      .items-list {
        margin-top: 30px;
      }

      .item-card {
        background: white;
        border: 2px solid #e9ecef;
        border-left: 5px solid #ff6f61;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
      }

      .item-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 20px rgba(255, 111, 97, 0.1);
        border-color: #ff6f61;
      }

      .item-details-container {
        display: flex;
        align-items: center;
        gap: 20px;
        flex: 1;
      }

      .note-image-small,
      .issue-cover-small {
        width: 80px;
        height: 110px;
        border-radius: 6px;
        overflow: hidden;
        flex-shrink: 0;
        border: 2px solid #ddd;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
      }

      .note-image-small img,
      .issue-cover-small img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .item-content h4 {
        color: #2c3e50;
        font-size: 18px;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .item-content p {
        color: #666;
        font-size: 14px;
        line-height: 1.5;
      }

      .category-badge {
        display: inline-block;
        background: #3498db;
        color: white;
        padding: 3px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        margin-right: 8px;
        margin-top: 5px;
      }

      /* BOTONES DE ACCI√ìN - ¬°MUY VISIBLES! */
      .item-actions-group {
        display: flex;
        gap: 12px;
        flex-shrink: 0;
      }

      .action-btn {
        padding: 10px 18px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        text-decoration: none;
        min-width: 100px;
        justify-content: center;
      }

      .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      }

      .btn-view {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
      }

      .btn-edit {
        background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
        color: #333;
      }

      .btn-delete {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
      }

      /* MODAL */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 2000;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 10px;
        width: 90%;
         max-width: auto; 
        max-height: 90vh;
        overflow-y: auto;
      }
 .issue-cover img{
max-height: 250px;
} 
      .modal-content h2 {
        color: #2c3e50;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #ff6f61;
      }

      .modal-close {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #7f8c8d;
      }

      /* REVISTA ACTUAL EN VISTA P√öBLICA */
      .current-issue {
        padding: 60px 0;
        /* background: white; */
      }

      .section-title {
        text-align: center;
        color: #2c3e50;
        font-size: 32px;
        margin-bottom: 40px;
        font-weight: 700;
      }

      .issue-container {
        display: flex;
        gap: 40px;
        align-items: flex-start;
      }

      .issue-cover {
        flex: 0 0 300px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .issue-cover img {
        width: 100%;
        height: auto;
        display: block;
      }

      .issue-content {
        flex: 1;
      }

      .issue-content h3 {
        color: #2c3e50;
        font-size: 28px;
        margin-bottom: 15px;
      }

      .issue-meta {
        color: #ff6f61;
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 20px;
      }

      .issue-description {
        font-size: 16px;
        line-height: 1.6;
        color: #555;
        margin-bottom: 30px;
      }

      .issue-actions {
        display: flex;
        gap: 15px;
      }

      .btn-outline {
        background: transparent;
        border: 2px solid #ff6f61;
        color: #ff6f61;
      }

      .btn-outline:hover {
        background: #ff6f61;
        color: white;
      }

      /* MODAL PARA VER REVISTA EN L√çNEA */
      .magazine-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        display: none;
        z-index: 3000;
        overflow: hidden;
      }

      .magazine-header {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        background: rgba(44, 62, 80, 0.9);
        color: white;
        padding: 20px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 3001;
      }

      .magazine-header h3 {
        margin: 0;
        font-size: 20px;
      }

      .close-magazine {
        background: #ff6f61;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .close-magazine:hover {
        background: #e55a50;
      }

      .magazine-container {
        position: absolute;
        top: 70px;
        left: 0;
        width: 100%;
        height: calc(100% - 70px);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .pdf-viewer-container {
        width: 100%;
        height: 100%;
        max-width: 3000px;
        background: #2c3e50;
        border-radius: 8px;
        overflow: hidden;
        position: relative;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      }

      .pdf-controls {
        position: absolute;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
        z-index: 10;
        background: rgba(255, 255, 255, 0.9);
        padding: 10px;
        border-radius: 6px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
      }

      .pdf-controls button {
        background: #2c3e50;
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s;
      }

      .pdf-controls button:hover {
        background: #ff6f61;
        transform: scale(1.05);
      }

      .pdf-controls select {
        padding: 8px 12px;
        border-radius: 4px;
        border: 1px solid #ddd;
        background: white;
        font-size: 14px;
      }


      

      .page-counter {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(44, 62, 80, 0.9);
        color: red;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
      }

      .loading-pdf {
        color: white;
        font-size: 18px;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }

      .loading-pdf i {
        font-size: 40px;
        color: #ff6f61;
      }

      .loading-pdf p {
        margin: 0;
      }

      /* RESPONSIVE */
      @media (max-width: 1500px) {
        .header-content {
          flex-direction: column;
          gap: 15px;
        }

        nav ul {
          flex-wrap: wrap;
          justify-content: center;
        }

        .issue-container {
          flex-direction: column;
        }

        .issue-cover {
          flex: 0 0 auto;
          width: 100%;
          max-width: 300px;
          margin: 0 auto;
        }

        .item-card {
          flex-direction: column;
          gap: 15px;
          text-align: center;
        }

        .item-details-container {
          flex-direction: column;
          text-align: center;
        }

        .item-actions-group {
          width: 100%;
          justify-content: center;
          flex-wrap: wrap;
        }

        .form-row {
          flex-direction: column;
        }

        .pdf-controls {
          flex-direction: column;
          align-items: center;
          top: 10px;
          right: 10px;
        }

        .magazine-header {
          flex-direction: column;
          gap: 10px;
          padding: 10px;
        }

        .magazine-container {
          top: 120px;
          height: calc(100% - 120px);
        }
      }



.categories {
  padding: 60px 0;
}

.categories-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 28px;
  justify-items: center;
}

.category-card {
  width: 100%;
  max-width: 260px;
  background: #fff;
  border-radius: 10px;
  padding: 22px 20px;
  box-shadow: 0 8px 22px rgba(0, 0, 0, 0.08);
  border-top: 3px solid #ff6f61;
  text-align: center;
  transition: all 0.3s ease;
}

.category-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 14px 30px rgba(0, 0, 0, 0.15);
}

.category-card i {
  font-size: 1.6rem;
  color: #ff6f61;
  margin-bottom: 12px;
}

.category-card h3 {
  font-family: "Montserrat", sans-serif;
  font-style: italic;
  font-size: 1.1rem;
  margin-bottom: 8px;
  color: #2c3e50;
}

.category-card p {
  font-size: 0.9rem;
  color: #666;
  line-height: 1.4;
}
.section-title {
  font-family: "Montserrat", sans-serif;
  font-style: italic;
  font-size: 1.8rem;
  color: #2c3e50;
  text-align: center;
  margin-bottom: 35px;
  position: relative;
}

.section-title::after {
  content: "";
  display: block;
  width: 60px;
  height: 3px;
  background: #4b8b60;
  margin: 10px auto 0;
  border-radius: 2px;
}
.featured-notes {
  padding: 70px 0;
  background: #ffffff;
}

.notes-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 32px;
}

.note-card {
  background: #fff;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;
  display: flex;
  flex-direction: column;
  max-width: 300px;
}

.note-card:hover {
  transform: translateY(-6px);
  box-shadow: 0 18px 40px rgba(0, 0, 0, 0.15);
}

.note-card img {
  width: 100%;
  height: 180px;
  object-fit: cover;
}

.note-card .note-content {
  padding: 18px 18px 22px;
  flex: 1;
}
.note-category {
  display: inline-block;
  background: #ff6f61;
  color: #fff;
  font-size: 0.75rem;
  padding: 4px 10px;
  border-radius: 20px;
  margin-bottom: 10px;
}
.note-card h4 {
  font-family: "Montserrat", sans-serif;
  font-style: italic;
  font-size: 1.05rem;
  color: #2c3e50;
  margin-bottom: 8px;
  padding: 18px;

}

.note-card p {
  font-size: 0.9rem;
  color: #555;
  line-height: 1.45;
  margin-bottom: 12px;
  padding: 0px 18px;

}

.note-meta {
  font-size: 0.75rem;
  color: #888;
  display: flex;
  justify-content: space-between;
  margin-top: auto;
}
@media (max-width: 1500px) {
  .categories-grid,
  .notes-grid {
    gap: 20px;
  }

  .category-card {
    max-width: 100%;
  }
}


    body.admin-mode #public-view {
  display: none !important;
}
body.admin-mode footer {
  display: none;
}
/* =========================
   OCULTAR VISTA P√öBLICA EN ADMIN
========================= */

body.admin-mode #public-view {
  display: none !important;
}

body.admin-mode footer {
  display: none !important;
}

/* Seguridad extra por si algo se renderiza fuera */
body.admin-mode .categories,
body.admin-mode .featured-notes,
body.admin-mode .category-notes,
body.admin-mode .current-issue,
body.admin-mode .past-issues {
  display: none !important;
}

/* Mostrar SOLO admin */
body.admin-mode #admin-panel {
  display: block !important;
}


/* Fondo del modal */
.modal {
  display: none; 
  position: fixed; 
  z-index: 1000; 
  left: 0;
  top: 0;
  width: 100%; 
  height: 100%; 
  overflow: auto; 
  background-color: rgba(0,0,0,0.6); 
  padding: 50px 0;
}

/* Contenido del modal */
.modal-content-nota {
  background: #fff;
  margin: auto;
  border-radius: 10px;
  width: 90%;
  max-width: 600px;
  overflow: hidden;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
  animation: fadeIn 0.3s ease;
}

.modal-content-nota img {
  width: 100%;
  height: 250px;
  object-fit: cover;
}

.modal-body {
  padding: 20px;
}

/* Cerrar bot√≥n */
.close {
  color: #333;
  float: right;
  font-size: 28px;
  font-weight: bold;
  margin: 10px 15px 0 0;
  cursor: pointer;
}

.close:hover {
  color: #ff6f61;
}

@keyframes fadeIn {
  from {opacity: 0; transform: translateY(-20px);}
  to {opacity: 1; transform: translateY(0);}
}
.revista-modal {
  max-width: 900px;
  width: 100%;
}

.modal .issue-container {
  margin: 0;
}
.modal {
  justify-content: center;
  align-items: center;
}
.modal-content.revista-modal {
    background: hsl(0, 0%, 100%);
    max-width: auto;
    width: 100%;
    border-radius: 16px;
    padding: 30px;
    /* position: relative; */
    box-shadow: 0 20px 60px rgba(0, 0, 0, .25);
    animation: modalFadeUp .35s 
ease;
    /* max-width: 500px !important; */
    /* max-height: 500px !important; */
    /* display: flex !important; */
}
.revista-modal {
    max-width: 900px;
    width: 100%;
}
.modal-content {
    background: white;
    padding: 30px;
    border-radius: 10px;
    width: 90%;
    max-width: auto;
    max-height: 90vh;
    overflow-y: auto;
}

.modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(4px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}
.modal-content.revista-modal {
  background: #fff;
  max-width: 900px;
  width: 92%;
  border-radius: 16px;
  padding: 30px;
  position: relative;
  box-shadow: 0 20px 60px rgba(0,0,0,.25);
  animation: modalFadeUp .35s ease;
}
@keyframes modalFadeUp {
  from {
    opacity: 0;
    transform: translateY(30px) scale(.98);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}
.modal-content .close {
  position: absolute;
  top: 18px;
  right: 22px;
  font-size: 28px;
  color: #999;
  cursor: pointer;
  transition: color .2s;
  padding: 5px;
}

.modal-content .close:hover {
  color: #ff6f61;
}
.revista-modal .issue-container {
  display: flex;
  gap: 30px;
  align-items: flex-start;
}

.revista-modal .issue-cover img {
  width: auto;
  max-height: 250px;
  border-radius: 10px;
  box-shadow: 0 10px 25px rgba(0,0,0,.15);
}

.revista-modal .issue-content {
  flex: 1;
}
.revista-modal h3 {
  font-size: 1.5rem;
  margin-bottom: 6px;
  color: #2c3e50;
}

.revista-modal .issue-meta {
  font-size: .85rem;
  color: #ff6f61;
  margin-bottom: 12px;
}

.revista-modal .issue-description {
  font-size: .95rem;
  color: #555;
  line-height: 1.5;
}
.revista-modal .issue-actions {
  margin-top: 22px;
  display: flex;
  gap: 14px;
  flex-wrap: wrap;
}

.revista-modal .btn {
  padding: 10px 18px;
  border-radius: 30px;
  font-size: .9rem;
}
@media (max-width: 768px) {
  .revista-modal .issue-container {
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  .revista-modal .issue-cover img {
    width: 180px;
  }
}
.revista-modal .issue-content {
  max-width: 420px;
}
.revista-modal .issue-actions {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.revista-modal .btn {
  width: 100%;
  text-align: center;
  padding: 12px 20px;
}
.revista-modal .issue-cover {
  max-width: 260px;
  max-height: 360px;
  width: auto;
  height: auto;
  overflow: hidden;
  border-radius: 10px;
}

.revista-modal .issue-cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

#pdf-canvas-container {
  display: flex;
  justify-content: center;
  gap: 0;
  perspective: 2000px;
  transform-style: preserve-3d;
}

#pdf-canvas-container canvas {
  margin: 0;
  transition: box-shadow 0.4s ease;
}

/* Animaciones */
#pdf-canvas-container.flip-next {
  animation: flipNext 0.6s ease;
}

#pdf-canvas-container.flip-prev {
  animation: flipPrev 0.6s ease;
}

@keyframes flipNext {
  0% {
    transform: rotateY(0deg);
  }
  100% {
    transform: rotateY(-12deg);
  }
}

@keyframes flipPrev {
  0% {
    transform: rotateY(0deg);
  }
  100% {
    transform: rotateY(12deg);
  }
}
/* =========================
   FIX VISOR PDF ‚Äì MOBILE SIN BORDES
========================= */
@media (max-width: 1500px) {
 /* Ocultamos lo innecesario */
  #zoom-select,
  #rotate-left,
  #rotate-right,
  #fullscreen-btn,
  .page-counter {
    display: none !important;
  }#prev-page { left: 10px; }
  #next-page { right: 10px; }
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
  }
    /* Flechas flotantes */
  #prev-page,
  #next-page {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    z-index: 1000;
    background: rgba(0,0,0,.4);
    border-radius: 50%;
    width: 48px;
    height: 48px;
  }

  #prev-page {
    left: 10px;
  }

  #next-page {
    right: 10px;
  }

  /* Modal ocupa TODO */
  #magazine-modal {
    inset: 0;
    padding: 0;
  }

  /* Contenedor principal */
  .magazine-container {
    width: 100vw;
    height: 100vh;
    margin: 0;
    padding: 0;
    border-radius: 0 !important;
    background: #0f172a;
  }

  /* Viewer intermedio */
  .pdf-viewer-container {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    border-radius: 0 !important;
    background: #0f172a;
  }

  /* Contenedor de canvases */
  .pdf-canvas-container {
    width: 200px;
    height: 500px;
    margin: 0;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #0f172a;
    overflow: hidden;
  }

  /* El PDF en s√≠ */
  .pdf-canvas-container canvas {
    width: 100vw !important;
    height: auto !important;
    max-height: 100vh !important;
    margin: 0 !important;
    padding: 0 !important;
    box-shadow: none !important;
    border-radius: 0 !important;
    background: white;
  }
  .pdf-canvas-container {
  display: flex;
  align-items: flex-start; /* üëà CLAVE */
  justify-content: center;
}
.pdf-canvas-container canvas {
  margin-top: 0 !important;
  align-self: flex-start;
}
.modal-content:not(.revista-modal) {
  max-width: 520px !important;
  width: 92%;
}

}

#pdf-canvas-container {
  width: 100% !important;           /* ocupar todo el ancho del modal */
  margin: 0 auto;        /* centrar en pantalla */
  display: flex;
  justify-content: center;
  gap: 20px;             /* espacio entre p√°ginas si hay dos canvas */
  overflow-x: auto;      /* permitir scroll horizontal si hace falta */
}
.pdf-book canvas {
  width: 100% !important;   /* ocupa todo el ancho disponible del contenedor */
  height: auto !important;  /* mantiene proporci√≥n */
  display: block;
}
</style>
  </head>
  <body>
    <!-- LOGIN -->
    <div id="login-container" class="login-container">
      <div class="login-form">
        <h2>Bit√°cora Cultural</h2>
        <p>Panel de Administraci√≥n</p>
        <div class="form-group">
          <label for="username">Usuario</label>
          <input type="text" id="username" placeholder="admin" />
        </div>
        <div class="form-group">
          <label for="password">Contrase√±a</label>
          <input type="password" id="password" placeholder="admin" />
        </div>
        <button class="btn btn-large" id="login-btn" style="width: 100%">
          Iniciar Sesi√≥n
        </button>
      </div>
    </div>

    <!-- VISTA P√öBLICA -->
    <div id="public-view">
      <header>
        <div class="container">
          <div class="header-content">
            <div class="logo">
              <div class="logo-image">
                <img
                  src="..//bitacoracultural/titulo.jpeg"
                  alt="Bit√°cora Cultural Logo"
                  width="350px"
                  margin-right="20px"
                />
              </div>
              <p>Revista Cultural Digital</p>
            </div>
            <nav >
              <ul>
                <li><a href="#inicio">Inicio</a></li>
                <li><a href="#revista">Revista Actual</a></li>
                <li><a href="#anteriores">Revistas Anteriores</a></li>
                <li><a href="#categorias">Categor√≠as</a></li>
                <li><a href="#notas">Notas</a></li>
                <li>
                  <a href="#" id="admin-toggle" class="admin-link">Admin</a>
                </li>
                
              </ul>
            </nav>
          </div>
        </div>
      </header>

      <!-- REVISTA ACTUAL -->
      <section class="current-issue" id="revista">
        <div class="container">
          <h2 class="section-title">Revista Actual</h2>
          <div class="issue-container">
            <div class="issue-cover">
              <img id="current-cover" src="" alt="Portada Revista Actual" />
            </div>
            <div class="issue-content">
              <h3 id="current-title"></h3>
              <p class="issue-meta" id="current-meta"></p>
              <p class="issue-description" id="current-description"></p>
              <div class="issue-actions">
                <a href="#" id="current-pdf" class="btn" target="_blank">
                  <i class="fas fa-download"></i> Descargar PDF
                </a>
                <a href="#" id="view-magazine-btn" class="btn btn-outline">
                  <i class="fas fa-eye"></i> Ver Revista Online
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- MODAL PARA VER REVISTA ONLINE -->
      <div id="magazine-modal" class="magazine-modal-overlay">
        <div class="magazine-header">
          <h3 id="magazine-title">Revista Online</h3>
          <button class="close-magazine" id="close-magazine">
            <i class="fas fa-times"></i> Cerrar
          </button>
        </div>
        <div class="magazine-container">
          <div class="pdf-viewer-container">
            <div class="pdf-controls">
              <button id="prev-page" title="P√°gina Anterior">
                <i class="fas fa-chevron-left"></i>
              </button>
              <button id="next-page" title="P√°gina Siguiente">
                <i class="fas fa-chevron-right"></i>
              </button>
              <select id="zoom-select">
                <option value="0.5">50%</option>
                <option value="0.75">75%</option>
                <option value="1" selected>100%</option>
                <option value="1.25">125%</option>
                <option value="1.5">150%</option>
                <option value="2">200%</option>
              </select>
              <button id="rotate-left" title="Rotar Izquierda">
                <i class="fas fa-redo"></i>
              </button>
              <button id="rotate-right" title="Rotar Derecha">
                <i class="fas fa-undo"></i>
              </button>
              <button id="fullscreen-btn" title="Pantalla Completa">
                <i class="fas fa-expand"></i>
              </button>
            </div>
            <div class="pdf-canvas-container" id="pdf-canvas-container" style="height: 100%;">

  <div class="loading-pdf" id="loading-pdf">
    <i class="fas fa-spinner fa-spin"></i>
    <p>Cargando revista...</p>
  </div>

  <div class="pdf-book" id="pdf-book">
    <canvas id="page-left"></canvas>
    <canvas id="page-right"></canvas>
  </div>

</div>

            <div class="page-counter" id="page-counter">
              P√°gina <span id="current-page">1</span> de
              <span id="total-pages">1</span>
            </div>
          </div>
        </div>
      </div>

      <!-- OTRAS SECCIONES -->
      <section
        class="past-issues"
        id="anteriores"
        style="padding: 60px 0; background: #f5f7fa"
      >
        <div class="container">
          <h2 class="section-title">Revistas Anteriores</h2>
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
              gap: 20px;
              margin-top: 30px;
            "
          >
            <!-- Revistas anteriores se cargar√°n aqu√≠ -->
          </div>
        </div>
      </section>
<!-- CATEGOR√çAS -->
<section class="categories" id="categorias">
  <div class="container">
    <h2 class="section-title">Categor√≠as</h2>
    <div class="categories-grid" id="categories-container">
      <!-- categor√≠as render JS -->
    </div>
  </div>
</section>

<!-- NOTAS -->
<section class="featured-notes" id="notas">
  <div class="container">
    <h2 class="section-title">Notas Period√≠sticas</h2>
    <div class="notes-grid" id="notes-container">
      <!-- notas render JS -->
    </div>
  </div>
</section>

<!-- NOTAS POR CATEGOR√çA -->
<section class="category-notes" id="category-notes" style="display:none;">
  <div class="container">
    <div class="category-header">
      <a href="#" id="back-to-categories">‚Üê Volver a Notas</a>
      <h2 class="section-title" id="category-title"></h2>
    </div>
    <div class="notes-grid" id="category-notes-container">
            <!-- notas filtradas render JS -->
    </div>
  </div>
</section>

      <footer
        style="
          background: #2c3e50;
          color: white;
          padding: 40px 0;
          text-align: center;
          margin-top: 50px;
        "
      >
        <div class="container">
          <p>&copy; 2026 Bit√°cora Cultural. Todos los derechos reservados.</p>
        </div>
      </footer>
    </div>

    <!-- PANEL DE ADMINISTRACI√ìN -->
    <div id="admin-panel">
      <div class="admin-header">
        <div class="container">
          <div class="header-content">
            <div class="logo">
              <h1>Panel de Administraci√≥n</h1>
              <p>Bit√°cora Cultural</p>
            </div>
            <nav>
              <ul>
                <li><a href="#" id="public-toggle">Volver al Sitio</a></li>
                <li><a href="#" id="logout-btn">Cerrar Sesi√≥n</a></li>
              </ul>
            </nav>
          </div>
        </div>
      </div>

      <div class="container">
        <!-- NAVEGACI√ìN DE TABS -->
        <div class="admin-nav">
          <button class="tab-btn active" data-tab="revistas">
            <i class="fas fa-newspaper"></i> Gestionar Revistas
          </button>
          <button class="tab-btn" data-tab="admin-categorias">
            <i class="fas fa-tags"></i> Gestionar Categor√≠as
          </button>
          <button class="tab-btn" data-tab="admin-notas">
            <i class="fas fa-file-alt"></i> Gestionar Notas
          </button>
        </div>

        <!-- TAB: GESTIONAR REVISTAS -->
        <div class="admin-section active" id="revistas">
          <h3><i class="fas fa-newspaper"></i> Gestionar Revistas</h3>

          <!-- Formulario para agregar revista -->
          <div class="form-row">
            <div class="form-group">
              <label for="issue-number">N√∫mero de Revista</label>
              <input type="number" id="issue-number" min="1" value="16" />
            </div>
            <div class="form-group">
              <label for="issue-month">Mes</label>
              <select id="issue-month">
                <option value="enero">Enero</option>
                <option value="febrero">Febrero</option>
                <option value="marzo" selected>Marzo</option>
                <option value="abril">Abril</option>
                <option value="mayo">Mayo</option>
                <option value="junio">Junio</option>
                <option value="julio">Julio</option>
                <option value="agosto">Agosto</option>
                <option value="septiembre">Septiembre</option>
                <option value="octubre">Octubre</option>
                <option value="noviembre">Noviembre</option>
                <option value="diciembre">Diciembre</option>
              </select>
            </div>
            <div class="form-group">
              <label for="issue-year">A√±o</label>
              <input
                type="number"
                id="issue-year"
                value="2026"
                min="2020"
                max="2030"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="issue-title">T√≠tulo</label>
            <input
              type="text"
              id="issue-title"
              placeholder="T√≠tulo de la revista"
            />
          </div>

          <div class="form-group">
            <label for="issue-description">Descripci√≥n</label>
            <textarea
              id="issue-description"
              placeholder="Descripci√≥n de la revista"
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Portada de Revista</label>
              <div class="file-input-container">
                <label class="file-input" for="issue-cover-input">
                  <i class="fas fa-image"></i>
                  <span>Haz clic para seleccionar portada</span>
                  <input
                    type="file"
                    id="issue-cover-input"
                    accept="image/*"
                    style="display: none"
                  />
                </label>
                <div class="image-preview-container">
                  <img
                    id="issue-cover-preview"
                    class="image-preview"
                    alt="Vista previa de portada"
                  />
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="issue-pdf">Archivo PDF (opcional)</label>
              <div class="file-input-container">
                <label class="file-input" for="issue-pdf-input">
                  <i class="fas fa-file-pdf"></i>
                  <span>Haz clic para seleccionar PDF</span>
                  <input
                    type="file"
                    id="issue-pdf-input"
                    accept=".pdf"
                    style="display: none"
                  />
                </label>
                <span
                  id="pdf-file-name"
                  style="
                    font-size: 14px;
                    color: #666;
                    margin-top: 5px;
                    display: block;
                  "
                ></span>
              </div>
            </div>
          </div>

          <button class="btn" id="add-issue-btn" style="margin-top: 20px">
            <i class="fas fa-plus"></i> Agregar Nueva Revista
          </button>

          <hr
            style="margin: 40px 0; border: none; border-top: 2px solid #eee"
          />

          <!-- LISTA DE REVISTAS PUBLICADAS -->
          <h4><i class="fas fa-list"></i> Revistas Publicadas</h4>
          <div class="items-list" id="issues-list">
            <!-- Las revistas se cargar√°n aqu√≠ din√°micamente -->
          </div>
        </div>

        <!-- TAB: GESTIONAR CATEGOR√çAS -->
        <div class="admin-section" id="admin-categorias">
          <h3><i class="fas fa-tags"></i> Gestionar Categor√≠as</h3>
          <div class="form-group">
            <label for="category-name">Nombre de Categor√≠a</label>
            <input type="text" id="category-name" placeholder="Ej: M√∫sica" />
          </div>
          <div class="form-group">
            <label for="category-description">Descripci√≥n</label>
            <textarea
              id="category-description"
              placeholder="Descripci√≥n de la categor√≠a"
            ></textarea>
          </div>
          <button class="btn" id="add-category-btn">
            <i class="fas fa-plus"></i> Agregar Categor√≠a
          </button>
          <div class="items-list" id="categories-list"></div>
        </div>

        <!-- TAB: GESTIONAR NOTAS -->
        <div class="admin-section" id="admin-notas">
          <h3><i class="fas fa-file-alt"></i> Gestionar Notas Period√≠sticas</h3>

          <div class="form-row">
            <div class="form-group">
              <label for="note-title">T√≠tulo de la Nota</label>
              <input
                type="text"
                id="note-title"
                placeholder="T√≠tulo de la nota period√≠stica"
              />
            </div>
            <div class="form-group">
              <label for="note-category">Categor√≠a</label>
              <select id="note-category">
                <!-- Se llenar√° din√°micamente con las categor√≠as -->
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="note-description">Descripci√≥n / Resumen</label>
            <textarea
              id="note-description"
              placeholder="Resumen de la nota period√≠stica"
              rows="3"
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Imagen de la Nota</label>
              <div class="file-input-container">
                <label class="file-input" for="note-image-input">
                  <i class="fas fa-camera"></i>
                  <span>Haz clic para seleccionar imagen</span>
                  <input
                    type="file"
                    id="note-image-input"
                    accept="image/*"
                    style="display: none"
                  />
                </label>
                <div class="image-preview-container">
                  <img
                    id="note-image-preview"
                    class="image-preview"
                    alt="Vista previa de imagen"
                  />
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="note-author">Autor</label>
              <input
                type="text"
                id="note-author"
                placeholder="Nombre del autor"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="note-content">Contenido Completo</label>
            <textarea
              id="note-content"
              placeholder="Contenido completo de la nota period√≠stica..."
              rows="6"
            ></textarea>
          </div>

          <button class="btn" id="add-note-btn">
            <i class="fas fa-plus"></i> Agregar Nota Period√≠stica
          </button>

          <hr style="margin: 30px 0; border-top: 1px solid #eee" />

          <h4><i class="fas fa-list"></i> Notas Publicadas</h4>
          <div class="items-list" id="notes-list"></div>
        </div>
      </div>
    </div>

    <!-- MODAL PARA EDITAR REVISTA -->
    <div id="edit-issue-modal" class="modal-overlay">
      <div class="modal-content" style="justify-content: center; align-items: center;max-width: 600px;">
        <button class="modal-close" id="close-edit-modal">&times;</button>
        <h2><i class="fas fa-edit"></i> Editar Revista</h2>

        <div class="form-group">
          <label for="edit-issue-number">N√∫mero</label>
          <input type="number" id="edit-issue-number" min="1" />
        </div>

        <div class="form-group">
          <label for="edit-issue-month">Mes</label>
          <select id="edit-issue-month">
            <option value="enero">Enero</option>
            <option value="febrero">Febrero</option>
            <option value="marzo">Marzo</option>
            <option value="abril">Abril</option>
            <option value="mayo">Mayo</option>
            <option value="junio">Junio</option>
            <option value="julio">Julio</option>
            <option value="agosto">Agosto</option>
            <option value="septiembre">Septiembre</option>
            <option value="octubre">Octubre</option>
            <option value="noviembre">Noviembre</option>
            <option value="diciembre">Diciembre</option>
          </select>
        </div>

        <div class="form-group">
          <label for="edit-issue-year">A√±o</label>
          <input type="number" id="edit-issue-year" min="2020" max="2030" />
        </div>

        <div class="form-group">
          <label for="edit-issue-title">T√≠tulo</label>
          <input type="text" id="edit-issue-title" />
        </div>

        <div class="form-group">
          <label for="edit-issue-description">Descripci√≥n</label>
          <textarea id="edit-issue-description" rows="4"></textarea>
        </div>

        <div class="form-group">
          <label>Portada de Revista</label>
          <div class="file-input-container">
            <label class="file-input" for="edit-issue-cover-input">
              <i class="fas fa-image"></i>
              <span>Haz clic para cambiar portada</span>
              <input
                type="file"
                id="edit-issue-cover-input"
                accept="image/*"
                style="display: none"
              />
            </label>
            <div class="image-preview-container">
              <img
                id="edit-issue-cover-preview"
                class="image-preview"
                alt="Vista previa de portada"
              />
            </div>
          </div>
        </div>

        <button
          type="button"
          class="btn"
          id="save-edit-btn"
          style="margin-top: 20px; width: 100%"
        >
          <i class="fas fa-save"></i> Guardar Cambios
        </button>
      </div>
    </div>

    <!-- MODAL PARA EDITAR NOTA -->
    <div id="edit-note-modal" class="modal-overlay">
      <div class="modal-content" style="max-width: 600px;">
        <button class="modal-close" id="close-note-modal">&times;</button>
        <h2><i class="fas fa-edit"></i> Editar Nota Period√≠stica</h2>

        <div class="form-group">
          <label for="edit-note-title">T√≠tulo de la Nota</label>
          <input type="text" id="edit-note-title" />
        </div>

        <div class="form-group">
          <label for="edit-note-category">Categor√≠a</label>
          <select id="edit-note-category">
            <!-- Se llenar√° din√°micamente -->
          </select>
        </div>

        <div class="form-group">
          <label for="edit-note-description">Descripci√≥n / Resumen</label>
          <textarea id="edit-note-description" rows="3"></textarea>
        </div>

        <div class="form-group">
          <label>Imagen de la Nota</label>
          <div class="file-input-container">
            <label class="file-input" for="edit-note-image-input">
              <i class="fas fa-camera"></i>
              <span>Haz clic para cambiar imagen</span>
              <input
                type="file"
                id="edit-note-image-input"
                accept="image/*"
                style="display: none"
              />
            </label>
            <div class="image-preview-container">
              <img
                id="edit-note-image-preview"
                class="image-preview"
                alt="Vista previa de imagen"
              />
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="edit-note-author">Autor</label>
          <input type="text" id="edit-note-author" />
        </div>

        <div class="form-group">
          <label for="edit-note-content">Contenido Completo</label>
          <textarea id="edit-note-content" rows="6"></textarea>
        </div>

        <button
          type="button"
          class="btn"
          id="save-note-btn"
          style="margin-top: 20px; width: 100%"
        >
          <i class="fas fa-save"></i> Guardar Cambios
        </button>
      </div>
    </div>
<!-- Modal de Nota -->
<div id="note-modal" class="modal">
  <div class="modal-content-nota">
    <span class="close">&times;</span>
    <img id="modal-img" src="" alt="Imagen de nota">
    <div class="modal-body">
      <!-- <span class="note-category" id="modal-category"></span> -->
      <h4 id="modal-title"></h4>
      <p id="modal-text"></p>
      <div class="note-meta" id="modal-meta">
        <span id="modal-author"></span>
        <span id="modal-date"></span>
      </div>
    </div>
  </div>
</div>
<!-- MODAL REVISTA -->
<div id="revista-modal" class="modal">
  <div class="modal-content revista-modal" style="width: auto; height: auto;">
    <span class="close">&times;</span>

    <div class="issue-container">
      <div class="issue-cover">
        <img id="modal-cover" src="" alt="Portada Revista" />
      </div>

      <div class="issue-content">
        <h3 id="modal-title"></h3>
        <p class="issue-meta" id="modal-meta"></p>
        <p class="issue-description" id="modal-description"></p>

        <div class="issue-actions">
          <a href="#" id="modal-pdf" class="btn" target="_blank">
            <i class="fas fa-download"></i> Descargar PDF
          </a>
          <a href="#" id="modal-online" class="btn btn-outline" target="_blank">
            <i class="fas fa-eye"></i> Ver Revista Online
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

    <script>
      // ============================================
      // SISTEMA DE REVISTAS Y NOTAS - CRUD COMPLETO
      // ============================================

      let revistas = [];
      let categorias = [];
      let notas = [];

let currentView = "public"; // "public" | "admin"
      let pageRendering = false;
      let pageNumPending = null;
      let currentPdfUrl = null;
      let pdfDoc = null;
      let currentPage = 1;
      let scale = 1.2;
      let rotation = 0;

      async function cargarDesdeJSON() {
        try {
          // Traer todo desde el backend
          const res = await fetch("./api/getAllData.php");
          const data = await res.json();

          // ============================
          // REVISTAS
          // ============================
          revistas = (data.issues || []).map((issue) => ({
            id: issue.id,
            number: issue.number,
            month: issue.month,
            year: issue.year,
            title: issue.title || "",
            description: issue.description || "",
            cover: issue.cover || "",
            coverData: issue.coverData || issue.cover || "",
            pdf: issue.pdf || "",
            pdfData: issue.pdfData || issue.pdf || "",
            isCurrent: false,
          }));

          if (revistas.length > 0) revistas[0].isCurrent = true;

          // ============================
          // CATEGOR√çAS
          // ============================
          categorias = (data.categories || []).map((c) => ({
            id: c.id,
            name: c.name || "",
            description: c.description || "",
            icon: c.icon || "",
          }));

          // ============================
          // NOTAS
          // ============================
          notas = (data.notes || []).map((n) => ({
            id: n.id,
            title: n.title || "",
            category: n.category || null,
            description: (n.content || n.description || "").substring(0, 120),
            content: n.content || n.description || "",
            image: n.image || "",
            imageData: n.imageData || "",
            author: n.author || "Redacci√≥n Bit√°cora Cultural",
            date: n.date || new Date().toISOString().split("T")[0],
            views: n.views || 0,
          }));

          console.log(
            "Revistas:",
            revistas,
            "Categor√≠as:",
            categorias,
            "Notas:",
            notas
          );
        } catch (error) {
          console.error("Error cargando datos desde el backend:", error);
        }
      }

      let revistaEditando = null;
      let notaEditando = null;
      let issueCoverFile = null;
      let issuePdfFile = null;
      let noteImageFile = null;
      let editIssueCoverFile = null;
      let notaEditandoId;
      let editNoteImageFile = null;

      // ============================================
      // FUNCIONES PRINCIPALES
      // ============================================

      // Inicializar la aplicaci√≥n
async function initApp() {
  await cargarDesdeJSON();
  cargarRevistas();
  cargarCategorias();
  cargarNotas();

  // if (currentView === "public") {
    renderCategoriasPublicas();
    renderNotasPublicas();
  // }

  setupEventListeners();
  initPdfViewer();
}

      // Cargar revistas en el admin y en la vista p√∫blica
      function cargarRevistas() {
  const issuesList = document.getElementById("issues-list");
  if (!issuesList) return;

  issuesList.innerHTML = "";

  const revistasOrdenadas = [...revistas].sort(
    (a, b) => Number(b.number) - Number(a.number)
  );

  revistasOrdenadas.forEach((revista) => {
    const revistaHTML = crearHTMLRevista(revista);
    issuesList.appendChild(revistaHTML);
  });

  // if (currentView === "public") {
    cargarRevistaActual();
    cargarRevistasAnteriores();
  // }
}

      // Cargar categor√≠as en los select
      function cargarCategorias() {
        const categorySelect = document.getElementById("note-category");
        const editCategorySelect =
          document.getElementById("edit-note-category");
        const categoriesList = document.getElementById("categories-list");

        if (!categorySelect) return;

        // Limpiar selects
        categorySelect.innerHTML =
          '<option value="">Seleccionar categor√≠a</option>';
        if (editCategorySelect) {
          editCategorySelect.innerHTML =
            '<option value="">Seleccionar categor√≠a</option>';
        }

        // Llenar selects
        categorias.forEach((categoria) => {
          const option = document.createElement("option");
          option.value = categoria.id;
          option.textContent = categoria.name;
          categorySelect.appendChild(option);

          if (editCategorySelect) {
            const option2 = document.createElement("option");
            option2.value = categoria.id;
            option2.textContent = categoria.name;
            editCategorySelect.appendChild(option2);
          }
        });

        // Cargar lista de categor√≠as en el admin
        if (categoriesList) {
          categoriesList.innerHTML = "";
          categorias.forEach((categoria) => {
            const div = document.createElement("div");
            div.className = "item-card";
            div.innerHTML = `
              <div class="item-details-container">
                <div class="item-content">
                  <h4>${categoria.name}</h4>
                  <p>${categoria.description}</p>
                  <span class="category-badge">ID: ${categoria.id}</span>
                </div>
              </div>
              <div class="item-actions-group">
                <button class="action-btn btn-edit" onclick="editarCategoria(${categoria.id})">
                  <i class="fas fa-edit"></i> Editar
                </button>
                <button class="action-btn btn-delete" onclick="eliminarCategoria(${categoria.id})">
                  <i class="fas fa-trash"></i> Eliminar
                </button>
              </div>
            `;
            categoriesList.appendChild(div);
          });
        }
      }

      // Cargar notas en el admin
      function cargarNotas() {
        const notesList = document.getElementById("notes-list");
        if (!notesList) return;

        // Limpiar lista
        notesList.innerHTML = "";

        // Ordenar por fecha (m√°s reciente primero)
        const notasOrdenadas = [...notas].sort(
          (a, b) => new Date(b.date) - new Date(a.date)
        );

        // Cargar cada nota en el admin
        notasOrdenadas.forEach((nota) => {
          const notaHTML = crearHTMLNota(nota);
          notesList.appendChild(notaHTML);
        });
      }
async function renderCategoriasPublicas() {
  const container = document.getElementById("categories-container");
  if (!container) return;

  container.innerHTML = "";

  try {
    // Traer las categor√≠as actualizadas desde el backend o el JSON
    const res = await fetch("./data.json");
    const data = await res.json();
    console.log(data)
    const categoriasActualizadas = data.categories || [];

    categoriasActualizadas.forEach((categoria) => {
      const div = document.createElement("div");
      div.className = "category-card";
      div.innerHTML = `
        <h3>${categoria.name}</h3>
        <p>${categoria.description || ""}</p>
      `;

      div.addEventListener("click", () => {
        renderNotasPorCategoria(categoria.id, categoria.name);
      });

      container.appendChild(div);
    });
  } catch (err) {
    console.error("Error cargando categor√≠as p√∫blicas:", err);
  }
}

function renderNotasPublicas() {
  const container = document.getElementById("notes-container");
  if (!container) return;

  container.innerHTML = "";

  notas.forEach((nota) => {
    const div = document.createElement("div");
    div.className = "note-card";

    // üëá ESTA L√çNEA ES LA CLAVE
    div.onclick = () => openModal(nota);

    div.innerHTML = `
      <img src="${nota.image || ""}" alt="${nota.title}">
      <h4>${nota.title}</h4>
      <p>${nota.description}</p>
    `;

    container.appendChild(div);
  });
}

function renderNotasPorCategoria(categoryId, categoryName) {
  document.getElementById("notas").style.display = "none";
  document.getElementById("category-notes").style.display = "block";

  document.getElementById("category-title").textContent = categoryName;

  const container = document.getElementById("category-notes-container");
  container.innerHTML = "";

  notas
    .filter((n) => n.category === categoryId)
    .forEach((nota) => {
      const div = document.createElement("div");
      div.className = "note-card";

      // üëá ESTA L√çNEA ES LA CLAVE
      div.onclick = () => openModal(nota);

      div.innerHTML = `
        <img src="${nota.image || ""}" alt="${nota.title}">
        <div class="note-content">
          <h4>${nota.title}</h4>
          <p>${nota.description}</p>
        </div>
      `;

      container.appendChild(div);
    });
}

      // Crear HTML para una revista en el admin
      function crearHTMLRevista(revista) {
        const div = document.createElement("div");
        div.className = "item-card";
        div.dataset.id = revista.id;

        div.innerHTML = `
          <div class="item-details-container">
              <div class="issue-cover-small">
                  <img src="${
                    revista.coverData ||
                    "https://dummyimage.com/80x110/cccccc/000000&text=Portada"
                  }" alt="Revista ${revista.number}">
              </div>
              <div class="item-content">
                  <h4>N¬∞ ${revista.number} - ${revista.title}</h4>
                  <p><strong>${capitalize(revista.month)} ${
          revista.year
        }</strong> | ${
          revista.isCurrent ? "‚≠ê Revista Actual" : "üìö Archivada"
        }</p>
                  <p>${revista.description.substring(0, 150)}...</p>
              </div>
          </div>
          <div class="item-actions-group">
              <button class="action-btn btn-view" onclick="verRevista(${
                revista.id
              })">
                  <i class="fas fa-eye"></i> Ver
              </button>
              <button class="action-btn btn-edit" onclick="editarRevista(${
                revista.id
              })">
                  <i class="fas fa-edit"></i> Editar
              </button>
              <button class="action-btn btn-delete" onclick="eliminarRevista(${
                revista.id
              })">
                  <i class="fas fa-trash"></i> Eliminar
              </button>
          </div>
        `;

        return div;
      }

      function getImageSrc(image) {
        if (!image) {
          return "https://dummyimage.com/80x110/cccccc/000000&text=Imagen";
        }

        if (image.startsWith("http") || image.startsWith("./api/uploads")) {
          return image;
        }

        return "./api/uploads/" + image;
      }

      // Crear HTML para una nota en el admin
      function crearHTMLNota(nota) {
        const div = document.createElement("div");
        div.className = "item-card";
        div.dataset.id = nota.id;

        const categoria = categorias.find((c) => c.id === nota.category);
        const categoriaNombre = categoria ? categoria.name : "Sin categor√≠a";
        const categoriaColor = getCategoryColor(nota.category);

        div.innerHTML = `
          <div class="item-details-container">
            <div class="note-image-small">
              <img src="${nota.image}" alt="${nota.title}">
            </div>
            <div class="item-content">
              <h4>${nota.title}</h4>
              <p>${nota.description.substring(0, 120)}...</p>
              <div style="margin-top: 8px;">
                <span class="category-badge" style="background: ${categoriaColor}">${categoriaNombre}</span>
                <span style="font-size: 12px; color: #7f8c8d;">
                  <i class="fas fa-user"></i> ${nota.author} | 
                  <i class="far fa-calendar"></i> ${formatDate(nota.date)} |
                  <i class="fas fa-eye"></i> ${nota.views} vistas
                </span>
              </div>
            </div>
          </div>
          <div class="item-actions-group">
            <button class="action-btn btn-view" onclick="verNota(${nota.id})">
              <i class="fas fa-eye"></i> Ver
            </button>
            <button class="action-btn btn-edit" onclick="editarNota(${
              nota.id
            })">
              <i class="fas fa-edit"></i> Editar
            </button>
            <button class="action-btn btn-delete" onclick="eliminarNota(${
              nota.id
            })">
              <i class="fas fa-trash"></i> Eliminar
            </button>
          </div>
        `;

        return div;
      }

      // Cargar revista actual en vista p√∫blica
      function cargarRevistaActual() {
        // Buscar la revista actual, o la √∫ltima si no hay ninguna seleccionada
        const revistasOrdenadas = [...revistas].sort(
          (a, b) => Number(b.number) - Number(a.number)
        );

        const revistaActual = revistasOrdenadas[0];

        if (!revistaActual) return;

        // Actualizar los elementos del HTML con los datos de la revista actual
        document.getElementById("current-title").textContent =
          revistaActual.title;
        document.getElementById("current-meta").textContent = `N¬∞ ${
          revistaActual.number
        } - ${capitalize(revistaActual.month)} ${revistaActual.year}`;
        document.getElementById("current-description").textContent =
          revistaActual.description;
        document.getElementById("current-cover").src =
          revistaActual.cover ||
          "https://via.placeholder.com/300x400?text=Portada+Revista";
        document.getElementById("current-pdf").href = revistaActual.pdf || "#";

        // Configurar el bot√≥n para ver revista online
        const viewMagazineBtn = document.getElementById("view-magazine-btn");
        if (viewMagazineBtn && revistaActual.pdf) {
          viewMagazineBtn.onclick = function (e) {
            e.preventDefault();
            abrirVisorRevista(revistaActual);
          };
        }
      }

      // Cargar revistas anteriores en vista p√∫blica
      // function cargarRevistasAnteriores() {
      //   const container = document.querySelector(
      //     ".past-issues .container > div"
      //   );
      //   if (!container) return;
      //   const revistasOrdenadas = [...revistas].sort(
      //     (a, b) => Number(b.number) - Number(a.number)
      //   );

      //   const revistasAnteriores = revistasOrdenadas
      //     .filter((r) => !r[0])
      //     .slice(1, 6);
      //   container.innerHTML = revistasAnteriores
      //     .map(
      //       (revista) => `
      //         <div style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
      //             <img src="${
      //               revista.coverData ||
      //               "https://via.placeholder.com/200x150?text=Revista"
      //             }" alt="Revista ${
      //         revista.number
      //       }" style="width: 100%; height: 150px; object-fit: cover;">
      //             <div style="padding: 15px;">
      //                 <h4 style="font-size: 14px; margin-bottom: 5px; color: #2c3e50;">N¬∞ ${
      //                   revista.number
      //                 }</h4>
      //                 <p style="font-size: 12px; color: #ff6f61; margin-bottom: 5px;">${capitalize(
      //                   revista.month
      //                 )} ${revista.year}</p>
      //                 <p style="font-size: 12px; color: #666;">${revista.title.substring(
      //                   0,
      //                   50
      //                 )}...</p>
      //             </div>
      //         </div>
      //     `
      //     )
      //     .join("");
      // }
      let revistasAnterioresGlobal = [];

function cargarRevistasAnteriores() {
  const container = document.querySelector(
    ".past-issues .container > div"
  );
  if (!container) return;

  const revistasOrdenadas = [...revistas].sort(
    (a, b) => Number(b.number) - Number(a.number)
  );

  revistasAnterioresGlobal = revistasOrdenadas
    .filter((r) => !r[0])
    .slice(1, 6);

  container.innerHTML = revistasAnterioresGlobal
    .map(
      (revista, index) => `
        <div
          class="issue-card"
          data-index="${index}"
          style="cursor:pointer; background:white; border-radius:8px; overflow:hidden; box-shadow:0 3px 10px rgba(0,0,0,0.1);"
        >
          <img src="${
            revista.coverData ||
            "https://via.placeholder.com/200x150?text=Revista"
          }"
          alt="Revista ${revista.number}"
          style="width:100%; height:150px; object-fit:cover;">

          <div style="padding:15px;">
            <h4 style="font-size:14px; margin-bottom:5px; color:#2c3e50;">
              N¬∞ ${revista.number}
            </h4>
            <p style="font-size:12px; color:#ff6f61; margin-bottom:5px;">
              ${capitalize(revista.month)} ${revista.year}
            </p>
            <p style="font-size:12px; color:#666;">
              ${revista.title.substring(0, 50)}...
            </p>
          </div>
        </div>
      `
    )
    .join("");
}
document.addEventListener("click", (e) => {
  const card = e.target.closest(".issue-card");
  if (!card) return;

  const index = card.dataset.index;
  const revista = revistasAnterioresGlobal[index];

  if (revista) {
    openRevistaModal(revista);
  }
});

      // ============================================
      // FUNCIONES PARA MANEJAR ARCHIVOS
      // ============================================

      // Convertir archivo a Base64
      function fileToBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.readAsDataURL(file);
          reader.onload = () => resolve(reader.result);
          reader.onerror = (error) => reject(error);
        });
      }

      // Mostrar vista previa de imagen
      function showImagePreview(input, previewId) {
        const file = input.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const preview = document.getElementById(previewId);
            preview.src = e.target.result;
            preview.classList.add("active");
          };
          reader.readAsDataURL(file);
        }
      }

      // ============================================
      // VISOR DE PDF - REVISTA ONLINE
      // ============================================
function isMobile() {
  return window.innerWidth <= 1500;
}

      function initPdfViewer() {
        // Configurar evento para cerrar revista
        document
          .getElementById("close-magazine")
          .addEventListener("click", function () {
            document.getElementById("magazine-modal").style.display = "none";
            if (pdfDoc) {
              pdfDoc.destroy();
              pdfDoc = null;
            }
          });

      document.getElementById("next-page").addEventListener("click", async () => {
  if (!pdfDoc) return;

  const container = document.getElementById("pdf-canvas-container");

  if (isMobile()) {
    if (currentPage + 1 > pdfDoc.numPages) return;

    container.classList.add("slide-next");

    setTimeout(async () => {
      container.classList.remove("slide-next");
      currentPage += 1;
      await renderSinglePage(currentPage);
    }, 300);

  } else {
    if (currentPage + 2 > pdfDoc.numPages) return;

    container.classList.add("flip-next");

    setTimeout(async () => {
      container.classList.remove("flip-next");
      currentPage += 2;
      await renderTwoPagesWithTransition(currentPage, "next");
    }, 500);
  }
});
document.getElementById("back-to-categories")?.addEventListener("click", (e) => {
  e.preventDefault();
  document.getElementById("category-notes").style.display = "none";
  document.getElementById("categorias").style.display = "block";
  document.getElementById("notas").style.display = "block";
});

document.getElementById("prev-page").addEventListener("click", async () => {
  if (!pdfDoc) return;

  const container = document.getElementById("pdf-canvas-container");

  if (isMobile()) {
    if (currentPage - 1 < 1) return;

    container.classList.add("slide-prev");

    setTimeout(async () => {
      container.classList.remove("slide-prev");
      currentPage -= 1;
      await renderSinglePage(currentPage);
    }, 300);

  } else {
    if (currentPage - 2 < 1) return;

    container.classList.add("flip-prev");

    setTimeout(async () => {
      container.classList.remove("flip-prev");
      currentPage -= 2;
      await renderTwoPagesWithTransition(currentPage, "prev");
    }, 500);
  }
});



        document
          .getElementById("zoom-select")
          .addEventListener("change", function () {
            scale = parseFloat(this.value);
            renderTwoPages(currentPage);          });

        document
          .getElementById("rotate-left")
          .addEventListener("click", function () {
            rotation -= 90;
            renderTwoPages(currentPage);          });

        document
          .getElementById("rotate-right")
          .addEventListener("click", function () {
            rotation += 90;
            renderTwoPages(currentPage);
          });

        document
          .getElementById("fullscreen-btn")
          .addEventListener("click", function () {
            const container = document.querySelector(".pdf-viewer-container");
            if (!document.fullscreenElement) {
              if (container.requestFullscreen) {
                container.requestFullscreen();
              } else if (container.webkitRequestFullscreen) {
                container.webkitRequestFullscreen();
              } else if (container.msRequestFullscreen) {
                container.msRequestFullscreen();
              }
            } else {
              if (document.exitFullscreen) {
                document.exitFullscreen();
              } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
              } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
              }
            }
          });

        // Cerrar con Escape
        document.addEventListener("keydown", function (e) {
          if (
            e.key === "Escape" &&
            document.getElementById("magazine-modal").style.display === "block"
          ) {
            document.getElementById("magazine-modal").style.display = "none";
            if (pdfDoc) {
              pdfDoc.destroy();
              pdfDoc = null;
            }
          }
        });
      }

      function abrirVisorRevista(revista) {
  if (!revista || !revista.pdf) {
    alert("Esta revista no tiene un PDF disponible para ver en l√≠nea.");
    return;
  }

  // üî• reset visor
  if (pdfDoc) {
    pdfDoc.destroy();
    pdfDoc = null;
  }
  currentPage = 1;
  rotation = 0;

  const modal = document.getElementById("magazine-modal");
  modal.style.display = "block";

  document.getElementById("magazine-title").textContent =
    `${revista.title} - N¬∞ ${revista.number}`;

  currentPdfUrl = revista.pdf;

  cargarPDFLibro(currentPdfUrl);
}

    // ============================================
// VISOR PDF DOBLE P√ÅGINA (TIPO LIBRO)
// ============================================



const canvasLeft = document.getElementById("page-left");
const canvasRight = document.getElementById("page-right");
const ctxLeft = canvasLeft.getContext("2d");
const ctxRight = canvasRight.getContext("2d");

pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
async function renderSinglePage(pageNum) {
  if (!pdfDoc) return;

  const container = document.getElementById("pdf-canvas-container");
  container.innerHTML = "";

  const page = await pdfDoc.getPage(pageNum);
  const viewport = page.getViewport({ scale: 1.1, rotation });

  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  canvas.width = viewport.width;
  canvas.height = viewport.height;

  canvas.style.background = "#fff";
  canvas.style.boxShadow = "0 8px 25px rgba(0,0,0,.25)";
  canvas.style.borderRadius = "8px";

  container.appendChild(canvas);

  await page.render({
    canvasContext: ctx,
    viewport
  }).promise;

  document.getElementById("current-page").textContent = pageNum;
  document.getElementById("total-pages").textContent = pdfDoc.numPages;
}

async function renderTwoPages(startPage) {
  if (!pdfDoc) return;

  const container = document.getElementById("pdf-canvas-container");
  container.innerHTML = "";

  const containerWidth = container.clientWidth; // ancho total disponible
  const gap = 20; // espacio entre p√°ginas
  const pageWidth = (containerWidth - gap) / 2; // ancho de cada p√°gina

  for (let i = 0; i < 2; i++) {
    const pageNum = startPage + i;
    if (pageNum > pdfDoc.numPages) break;

    const page = await pdfDoc.getPage(pageNum);

    // Calculamos el viewport escalado para que quepa en el ancho disponible
    const viewport = page.getViewport({ scale: 1, rotation });
    const scaleX = pageWidth / viewport.width;
    const scaleY = scaleX; // mantenemos proporci√≥n
    const scaledViewport = page.getViewport({ scale: scaleX, rotation });

    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = scaledViewport.width;
    canvas.height = scaledViewport.height;

    canvas.style.background = "#fff";
    canvas.style.boxShadow = "0 0 10px rgba(0,0,0,.4)";
    canvas.style.margin = "0px";

    container.appendChild(canvas);

    await page.render({
      canvasContext: ctx,
      viewport: scaledViewport
    }).promise;
  }

  document.getElementById("current-page").textContent = startPage;
  document.getElementById("total-pages").textContent = pdfDoc.numPages;
}

function renderTwoPagesWithTransition(startPage, direction = "next") {
  const container = document.getElementById("pdf-canvas-container");

  // animaci√≥n de salida
  container.classList.remove("fade-in");
  container.classList.add("fade-out");

  setTimeout(async () => {
    await renderTwoPages(startPage);

    // animaci√≥n de entrada
    container.classList.remove("fade-out");
    container.classList.add("fade-in");
  }, 180);
}

async function cargarPDFLibro(pdfUrl) {
  const loadingTask = pdfjsLib.getDocument(pdfUrl);
  pdfDoc = await loadingTask.promise;
  currentPage = 1;

  if (isMobile()) {
    renderSinglePage(currentPage);
  } else {
    renderTwoPages(currentPage);
  }
}


      // ============================================
      // CRUD - REVISTAS
      // ============================================

      // CREAR - Agregar nueva revista conectada al backend
async function agregarRevista() {
  const number = document.getElementById("issue-number").value;
  const month = document.getElementById("issue-month").value;
  const year = document.getElementById("issue-year").value;
  const title = document.getElementById("issue-title").value;
  const description = document.getElementById("issue-description").value;

  if (!title || !number) {
    alert("Por favor complete el t√≠tulo y n√∫mero de la revista");
    return;
  }

  if (!issueCoverFile) {
    alert("Por favor seleccione una portada para la revista");
    return;
  }

  try {
    const formData = new FormData();
    formData.append("number", number);
    formData.append("month", month);
    formData.append("year", year);
    formData.append("title", title);
    formData.append("description", description);
    formData.append("cover", issueCoverFile);
    if (issuePdfFile) formData.append("pdf", issuePdfFile);

    const res = await fetch("./api/issues.php", {
      method: "POST",
      body: formData,
    });

    const data = await res.json();

    if (data.status === "success") {
      // üîπ Crear objeto de revista con la imagen lista para mostrar
      const nuevaRevista = data.data;

      // Convertir la imagen subida a base64 para mostrar en admin al instante
      if (issueCoverFile) {
        nuevaRevista.coverData = await fileToBase64(issueCoverFile);
      }

      // Agregar al array local
      revistas.push(nuevaRevista);

      // üîπ Actualizar vistas
      cargarRevistas();

      // Limpiar formulario y archivos
      document.getElementById("issue-title").value = "";
      document.getElementById("issue-description").value = "";
      document.getElementById("issue-number").value = parseInt(number) + 1;

      issueCoverFile = null;
      issuePdfFile = null;
      document.getElementById("issue-cover-input").value = "";
      document.getElementById("issue-pdf-input").value = "";
      document.getElementById("issue-cover-preview").classList.remove("active");
      document.getElementById("pdf-file-name").textContent = "";

      alert(`‚úÖ Revista "${title}" agregada correctamente`);
      console.log("Nueva revista agregada:", nuevaRevista);
    } else {
      alert("‚ùå Error al crear la revista: " + data.message);
    }
  } catch (error) {
    console.error("Error creando revista en backend:", error);
    alert("‚ùå Error al comunicarse con el servidor");
  }
}

      // LEER - Ver detalles de revista
      function verRevista(id) {
        const revista = revistas.find((r) => r.id === id);
        if (revista) {
          alert(
            `üìñ Revista N¬∞ ${revista.number}\nüìå T√≠tulo: ${
              revista.title
            }\nüìÖ ${capitalize(revista.month)} ${revista.year}\n\n${
              revista.description
            }`
          );
        }
      }

      // ACTUALIZAR - Editar revista
      // Abrir modal y llenar formulario para editar
      async function editarRevista(id) {
        const revista = revistas.find((r) => r.id === id);
        if (!revista) return;

        revistaEditando = revista;

        document.getElementById("edit-issue-number").value = revista.number;
        document.getElementById("edit-issue-month").value = revista.month;
        document.getElementById("edit-issue-year").value = revista.year;
        document.getElementById("edit-issue-title").value = revista.title;
        document.getElementById("edit-issue-description").value =
          revista.description;

        // Vista previa portada
        const preview = document.getElementById("edit-issue-cover-preview");
        if (revista.coverData) {
          preview.src = revista.coverData;
          preview.classList.add("active");
        } else {
          preview.classList.remove("active");
          preview.src = "";
        }

        // Mostrar modal
        document.getElementById("edit-issue-modal").style.display = "flex";
      }

      // Guardar cambios editados y actualizar backend
      let guardarEdicionRevista;

  guardarEdicionRevista = async (event) => {
  event?.preventDefault?.();
  if (!revistaEditando) return;

  const formData = new FormData();
  formData.append("_method", "PUT");
  formData.append("id", revistaEditando.id);
  formData.append("number", document.getElementById("edit-issue-number").value);
  formData.append("month", document.getElementById("edit-issue-month").value);
  formData.append("year", document.getElementById("edit-issue-year").value);
  formData.append("title", document.getElementById("edit-issue-title").value);
  formData.append("description", document.getElementById("edit-issue-description").value);

  if (editIssueCoverFile) formData.append("cover", editIssueCoverFile);

  try {
    const res = await fetch("./api/issues.php", {
      method: "POST",
      body: formData,
    });
    const data = await res.json();

    if (data.status === "success") {
      const index = revistas.findIndex(r => r.id === revistaEditando.id);
      if (index !== -1) {
        revistas[index] = data.data;

        // üîπ Si subiste nueva imagen, la convertimos a base64
        if (editIssueCoverFile) {
          revistas[index].coverData = await fileToBase64(editIssueCoverFile);
        } else {
          // üîπ Si no subiste nueva imagen, mantener la coverData anterior
          revistas[index].coverData = revistaEditando.coverData || "";
        }
      }

      // üîπ Actualizar vistas
      cargarRevistas();
      cargarRevistaActual();
      cargarRevistasAnteriores();

      cerrarModalEdicion();
      alert(`‚úèÔ∏è Revista "${data.data.title}" actualizada correctamente`);

      // Limpiar variables
      editIssueCoverFile = null;
      document.getElementById("edit-issue-cover-preview").classList.remove("active");
      revistaEditando = null;
    } else {
      console.error("Error del backend:", data);
      alert("Error al actualizar la revista");
    }
  } catch (error) {
    console.error("Error en la petici√≥n al backend:", error);
    alert("Error al comunicarse con el backend");
  }
};
   // ELIMINAR - Borrar revista
      async function eliminarRevista(id) {
        const revista = revistas.find((r) => r.id === id);
        if (!revista) return;

        const confirmacion = confirm(
          `¬øEst√° seguro de eliminar la revista N¬∞ ${revista.number} - "${revista.title}"?\n\nEsta acci√≥n no se puede deshacer.`
        );

        if (!confirmacion) return;

        try {
          // Llamada al backend para eliminar
          const res = await fetch(`./api/issues.php?id=${id}`, {
            method: "DELETE",
          });
          const result = await res.json();

          if (result.status === "success") {
            // Si era la revista actual, asignar otra como actual
            if (revista.isCurrent && revistas.length > 1) {
              const otraRevista = revistas.find((r) => r.id !== id);
              if (otraRevista) otraRevista.isCurrent = true;
            }

            revistas = revistas.filter(r => r.id !== id);

cargarRevistas(); // admin
  cargarRevistaActual();       
  cargarRevistasAnteriores();



            alert(`üóëÔ∏è Revista "${revista.title}" eliminada correctamente`);
            console.log("Revista eliminada:", revista);
          } else {
            console.error("Error al eliminar revista:", result);
            alert("‚ùå No se pudo eliminar la revista");
          }
        } catch (error) {
          console.error("Error en la petici√≥n al backend:", error);
          alert("‚ùå Ocurri√≥ un error al eliminar la revista");
        }
      }

      // ============================================
      // CRUD - CATEGOR√çAS
      // ============================================

      // Agregar nueva categor√≠a (con backend)
      async function agregarCategoria() {
        const name = document.getElementById("category-name").value;
        const description = document.getElementById(
          "category-description"
        ).value;

        if (!name) {
          alert("Por favor ingrese el nombre de la categor√≠a");
          return;
        }

        const nuevaCategoria = { name, description };

        try {
          const res = await fetch("./api/categories.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(nuevaCategoria),
          });

          const data = await res.json();

          if (data.status === "success") {
            // Agregar al array local y actualizar interfaz
            // Al agregar categor√≠a
categorias.push(data.data);
cargarCategorias();          // admin
renderCategoriasPublicas();  // p√∫blico

            // Limpiar formulario
            document.getElementById("category-name").value = "";
            document.getElementById("category-description").value = "";

            alert(`‚úÖ Categor√≠a "${name}" agregada correctamente`);
            console.log("Nueva categor√≠a agregada:", data.data);
          } else {
            alert("‚ùå Error al agregar categor√≠a");
            console.error(data);
          }
        } catch (error) {
          console.error("Error conectando al backend:", error);
          alert("‚ùå Error al conectar con el servidor");
        }
      }

      // Editar categor√≠a (con backend)
      async function editarCategoria(id) {
        const categoria = categorias.find((c) => c.id === id);
        if (!categoria) return;

        const nuevoNombre = prompt(
          "Nuevo nombre de la categor√≠a:",
          categoria.name
        );
        if (!nuevoNombre || nuevoNombre.trim() === "") return;

        const nuevaDescripcion = prompt(
          "Nueva descripci√≥n:",
          categoria.description
        );
        if (nuevaDescripcion === null) return;

        const categoriaActualizada = {
          id: categoria.id,
          name: nuevoNombre.trim(),
          description: nuevaDescripcion,
        };

        try {
          const res = await fetch(`./api/categories.php`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(categoriaActualizada),
          });

          const data = await res.json();

          if (data.status === "success") {
// Al editar categor√≠a
categoria.name = categoriaActualizada.name;
categoria.description = categoriaActualizada.description;
cargarCategorias();           // admin
renderCategoriasPublicas();   // p√∫blico
            alert(`‚úÖ Categor√≠a actualizada correctamente`);
            console.log("Categor√≠a actualizada:", categoriaActualizada);
          } else {
            alert("‚ùå Error al actualizar categor√≠a");
            console.error(data);
          }
        } catch (error) {
          console.error("Error conectando al backend:", error);
          alert("‚ùå Error al conectar con el servidor");
        }
      }

      // Eliminar categor√≠a
      async function eliminarCategoria(id) {
        const categoria = categorias.find((c) => c.id === id);
        if (!categoria) return;

        // Verificar si hay notas con esta categor√≠a
        const notasConCategoria = notas.filter((n) => n.category === id);
        if (notasConCategoria.length > 0) {
          alert(
            `No se puede eliminar la categor√≠a "${categoria.name}" porque tiene ${notasConCategoria.length} nota(s) asociada(s).\n\nPrimero debe reasignar o eliminar esas notas.`
          );
          return;
        }

        const confirmacion = confirm(
          `¬øEst√° seguro de eliminar la categor√≠a "${categoria.name}"?\n\nEsta acci√≥n no se puede deshacer.`
        );
        if (!confirmacion) return;

        try {
          const res = await fetch(`./api/categories.php?id=${id}`, {
            method: "DELETE",
          });
          const result = await res.json();

          if (result.status === "success") {

            /// Al eliminar categor√≠a
categorias = categorias.filter((c) => c.id !== id);
cargarCategorias();           // admin
renderCategoriasPublicas();   // p√∫blico

            alert(`üóëÔ∏è Categor√≠a "${categoria.name}" eliminada correctamente`);
            console.log("Categor√≠a eliminada:", categoria);
          } else {
            console.error("Error backend:", result);
            alert("Error eliminando categor√≠a");
          }
        } catch (error) {
          console.error("Error conectando al backend:", error);
          alert("Error conectando al backend");
        }
      }

      // ============================================
      // CRUD - NOTAS PERIOD√çSTICAS
      // ============================================

      // CREAR - Agregar nueva nota
      async function agregarNota() {
        const title = document.getElementById("note-title").value.trim();
        const category = parseInt(
          document.getElementById("note-category").value
        );
        const description = document
          .getElementById("note-description")
          .value.trim();
        const content = document.getElementById("note-content").value.trim();
        const author = document.getElementById("note-author").value.trim();

        if (!title || !category || !description) {
          alert("Por favor complete t√≠tulo, categor√≠a y descripci√≥n");
          return;
        }

        const categoria = categorias.find((c) => c.id === category);
        if (!categoria) {
          alert("La categor√≠a seleccionada no existe");
          return;
        }

        if (!noteImageFile) {
          alert("Por favor seleccione una imagen");
          return;
        }

        try {
          const formData = new FormData();
          formData.append("title", title);
          formData.append("category", category);
          formData.append("description", description);
          formData.append("content", content || description);
          formData.append("author", author || "Redacci√≥n Bit√°cora Cultural");
          formData.append("imageFile", noteImageFile);

          const res = await fetch("./api/notes.php", {
            method: "POST",
            body: formData,
          });

          const result = await res.json();

          if (!res.ok || result.status !== "success") {
            console.error("Error backend:", result);
            alert("Error agregando la nota");
            return;
          }
// Al agregar nota
notas.push(result.data);
cargarNotas();         // admin
renderNotasPublicas(); // p√∫blico

          // Limpiar formulario
          document.getElementById("note-title").value = "";
          document.getElementById("note-category").value = "";
          document.getElementById("note-description").value = "";
          document.getElementById("note-content").value = "";
          document.getElementById("note-author").value = "";
          document.getElementById("note-image-input").value = "";
          document
            .getElementById("note-image-preview")
            .classList.remove("active");

          noteImageFile = null;

          alert(`‚úÖ Nota "${title}" agregada correctamente`);
          console.log("Nota creada:", result.data);
        } catch (error) {
          console.error("Error conectando al backend:", error);
          alert("Error conectando al backend");
        }
      }

      // LEER - Ver detalles de nota
      function verNota(id) {
        const nota = notas.find((n) => n.id === id);
        if (nota) {
          const categoria = categorias.find((c) => c.id === nota.category);
          const categoriaNombre = categoria ? categoria.name : "Sin categor√≠a";

          alert(
            `üì∞ ${nota.title}\n\nüìå Categor√≠a: ${categoriaNombre}\n‚úçÔ∏è Autor: ${
              nota.author
            }\nüìÖ Fecha: ${formatDate(nota.date)}\nüëÅÔ∏è Vistas: ${
              nota.views
            }\n\n${nota.description}\n\n---\n${nota.content.substring(
              0,
              300
            )}...`
          );
        }
      }

      // =========================
      // EDITAR NOTA
      // =========================
      function editarNota(id) {
        const nota = notas.find((n) => n.id === id);
        if (!nota) return;

        notaEditandoId = id;
        editNoteImageFile = null;

        document.getElementById("edit-note-title").value = nota.title;
        document.getElementById("edit-note-category").value = nota.category;
        document.getElementById("edit-note-description").value =
          nota.description;
        document.getElementById("edit-note-author").value = nota.author;
        document.getElementById("edit-note-content").value = nota.content;

        const preview = document.getElementById("edit-note-image-preview");
        preview.src = nota.image || "";
        preview.style.display = nota.image ? "block" : "none";

        document.getElementById("edit-note-modal").style.display = "flex";
      }

      // =========================
      // GUARDAR CAMBIOS DE NOTA
      // =========================
      async function guardarEdicionNota() {
        if (!notaEditandoId) {
          alert("No hay nota en edici√≥n");
          return;
        }

        const formData = new FormData();
        formData.append("id", notaEditandoId);
        formData.append(
          "title",
          document.getElementById("edit-note-title").value
        );
        formData.append(
          "category",
          document.getElementById("edit-note-category").value
        );
        formData.append(
          "description",
          document.getElementById("edit-note-description").value
        );
        formData.append(
          "author",
          document.getElementById("edit-note-author").value
        );
        formData.append(
          "content",
          document.getElementById("edit-note-content").value
        );

        // üëâ SOLO si se seleccion√≥ una imagen nueva
        if (editNoteImageFile) {
          formData.append("imageFile", editNoteImageFile);
        }

        try {
          const res = await fetch("./api/notes.php", {
            method: "POST",
            body: formData,
          });

          const data = await res.json();
          if (!data.status) {
            alert("Error al actualizar la nota");
            return;
          }

          document.getElementById("edit-note-modal").style.display = "none";
          notaEditandoId = null;
          editNoteImageFile = null;

          await cargarDesdeJSON();
          cargarNotas();
renderNotasPublicas(); // p√∫blico

          alert("‚úÖ Nota actualizada correctamente");
        } catch (error) {
          console.error("Error actualizando nota:", error);
          alert("Error al conectar con el backend");
        }
      }

      // ELIMINAR - Borrar nota
      async function eliminarNota(id) {
        const nota = notas.find((n) => n.id === id);
        if (!nota) return;

        const confirmacion = confirm(
          `¬øEst√° seguro de eliminar la nota "${nota.title}"?\n\nEsta acci√≥n no se puede deshacer.`
        );

        if (!confirmacion) return;

        try {
          const res = await fetch(`./api/notes.php?id=${id}`, {
            method: "DELETE",
          });

          const data = await res.json();

          if (!res.ok || data.status !== "success") {
            throw new Error(data.error || "Error al eliminar");
          }
notas = notas.filter((n) => n.id !== id);
cargarNotas();         // admin
renderNotasPublicas(); // p√∫blico


          alert(`üóëÔ∏è Nota "${nota.title}" eliminada correctamente`);
          console.log("Nota eliminada:", nota);
        } catch (error) {
          console.error("Error eliminando nota:", error);
          alert("‚ùå No se pudo eliminar la nota");
        }
      }

      // ============================================
      // UTILIDADES
      // ============================================

      function capitalize(text) {
        return text.charAt(0).toUpperCase() + text.slice(1);
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("es-ES", {
          day: "2-digit",
          month: "short",
          year: "numeric",
        });
      }

      function getCategoryColor(category) {
        const colors = [
          "#3498db", // Azul
          "#2ecc71", // Verde
          "#e74c3c", // Rojo
          "#9b59b6", // P√∫rpura
          "#f39c12", // Naranja
          "#1abc9c", // Turquesa
          "#d35400", // Calabaza
          "#34495e", // Gris oscuro
        ];
        return colors[category % colors.length];
      }

      function cerrarModalEdicion() {
        document.getElementById("edit-issue-modal").style.display = "none";
        revistaEditando = null;
        editIssueCoverFile = null;
        document.getElementById("edit-issue-cover-input").value = "";
        document
          .getElementById("edit-issue-cover-preview")
          .classList.remove("active");
      }

      function cerrarModalNota() {
        document
          .getElementById("close-note-modal")
          .addEventListener("click", () => {
            notaEditandoId = null;
            document.getElementById("edit-note-modal").style.display = "none";
          });
      }

      // ============================================
      // EVENT LISTENERS
      // ============================================

      function setupEventListeners() {
        // Login/Logout
        document
          .getElementById("admin-toggle")
          .addEventListener("click", (e) => {
            e.preventDefault();
            document.getElementById("login-container").style.display = "flex";
          });

        document.getElementById("login-btn").addEventListener("click", () => {
          const user = document.getElementById("username").value;
          const pass = document.getElementById("password").value;

          if (user === "admin" && pass === "admin") {
            document.body.classList.add("admin-mode");
          currentView = "admin"
            document.getElementById("login-container").style.display = "none";
            document.getElementById("public-view").style.display = "none";
            document.getElementById("admin-panel").style.display = "block";
          } else {
            alert("Usuario o contrase√±a incorrectos");
          }
        });

        document
          .getElementById("public-toggle")
          .addEventListener("click", (e) => {
            e.preventDefault();
            document.body.classList.remove("admin-mode");
            currentView = "public";
            document.getElementById("admin-panel").style.display = "none";
            document.getElementById("public-view").style.display = "block";
          });

        document.getElementById("logout-btn").addEventListener("click", (e) => {
          document.body.classList.remove("admin-mode");
          currentView = "public";
          e.preventDefault();
          document.getElementById("admin-panel").style.display = "none";
          document.getElementById("public-view").style.display = "block";
        });

        // Tabs admin
        document.querySelectorAll(".tab-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            const tabId = this.dataset.tab;

            // Remover active de todos
            document
              .querySelectorAll(".tab-btn")
              .forEach((b) => b.classList.remove("active"));
            document
              .querySelectorAll(".admin-section")
              .forEach((s) => s.classList.remove("active"));

            // Agregar active al seleccionado
            this.classList.add("active");
            document.getElementById(tabId).classList.add("active");
          });
        });

        // Manejo de archivos - Revista
        document
          .getElementById("issue-cover-input")
          .addEventListener("change", function (e) {
            if (this.files.length > 0) {
              issueCoverFile = this.files[0];
              showImagePreview(this, "issue-cover-preview");
            }
          });

        document
          .getElementById("issue-pdf-input")
          .addEventListener("change", function (e) {
            if (this.files.length > 0) {
              issuePdfFile = this.files[0];
              document.getElementById(
                "pdf-file-name"
              ).textContent = `Archivo seleccionado: ${issuePdfFile.name}`;
            }
          });

        // Manejo de archivos - Nota
        document
          .getElementById("note-image-input")
          .addEventListener("change", function (e) {
            if (this.files.length > 0) {
              noteImageFile = this.files[0];
              showImagePreview(this, "note-image-preview");
            }
          });

        // Manejo de archivos - Editar Revista
        document
          .getElementById("edit-issue-cover-input")
          .addEventListener("change", function (e) {
            if (this.files.length > 0) {
              editIssueCoverFile = this.files[0];
              showImagePreview(this, "edit-issue-cover-preview");
            }
          });

        // Agregar revista
        document
          .getElementById("add-issue-btn")
          .addEventListener("click", agregarRevista);

        // Agregar categor√≠a
        document
          .getElementById("add-category-btn")
          .addEventListener("click", agregarCategoria);

        // Agregar nota
        document
          .getElementById("add-note-btn")
          .addEventListener("click", agregarNota);

        // Guardar edici√≥n revista
        document
          .getElementById("save-edit-btn")
          .addEventListener("click", guardarEdicionRevista);

        // Imagen nueva en editar nota ‚Üí vista previa
        document
          .getElementById("edit-note-image-input")
          .addEventListener("change", function () {
            if (this.files.length > 0) {
              editNoteImageFile = this.files[0];

              const preview = document.getElementById(
                "edit-note-image-preview"
              );
              preview.src = URL.createObjectURL(editNoteImageFile);
              preview.style.display = "block";
            }
          });

        // Guardar edici√≥n nota
        document
          .getElementById("save-note-btn")
          .addEventListener("click", guardarEdicionNota);

        // Cerrar modales
        document
          .getElementById("close-edit-modal")
          .addEventListener("click", cerrarModalEdicion);

        document
          .getElementById("close-note-modal")
          .addEventListener("click", cerrarModalNota);

        // Cerrar modal al hacer clic fuera
        document
          .getElementById("edit-issue-modal")
          .addEventListener("click", (e) => {
            if (e.target === document.getElementById("edit-issue-modal")) {
              cerrarModalEdicion();
            }
          });

        document
          .getElementById("edit-note-modal")
          .addEventListener("click", (e) => {
            if (e.target === document.getElementById("edit-note-modal")) {
              cerrarModalNota();
            }
          });

        // Hacer clic en las √°reas de archivo
        document.querySelectorAll(".file-input").forEach((label) => {
          label.addEventListener("click", function (e) {
            const inputId = this.getAttribute("for");
            if (inputId) {
              document.getElementById(inputId).click();
            }
          });
        });
      }

      // ============================================
      // INICIALIZAR APLICACI√ìN
      // ============================================

      document.addEventListener("DOMContentLoaded", initApp);

      // Funciones globales
      window.marcarComoActual = function (id) {
        // Quitar "actual" de todas las revistas
        revistas.forEach((revista) => {
          revista.isCurrent = revista.id === id;
        });

        // Actualizar interfaz
        cargarRevistas();

        // Mostrar confirmaci√≥n
        const revista = revistas.find((r) => r.id === id);
        if (revista) {
          alert(`‚≠ê Revista N¬∞ ${revista.number} marcada como actual`);
        }
      };

      window.verRevista = verRevista;
      window.editarRevista = editarRevista;
      window.eliminarRevista = eliminarRevista;
      window.verNota = verNota;
      window.editarNota = editarNota;
      window.eliminarNota = eliminarNota;
      window.editarCategoria = editarCategoria;
      window.eliminarCategoria = eliminarCategoria;

      // Funci√≥n para exportar datos (√∫til para debug)
      function exportarDatos() {
        console.log("üìä Datos actuales:", { revistas, categorias, notas });
        alert(
          `Total de revistas: ${revistas.length}\nTotal de notas: ${notas.length}\nTotal de categor√≠as: ${categorias.length}`
        );
      }

      // Atajos de teclado
      document.addEventListener("keydown", (e) => {
        // Ctrl+E para exportar datos
        if (e.ctrlKey && e.key === "e") {
          e.preventDefault();
          exportarDatos();
        }
      });
      const modal = document.getElementById("note-modal");
const modalImg = document.getElementById("modal-img");
const modalCategory = document.getElementById("modal-category");
const modalTitle = document.getElementById("modal-title");
const modalText = document.getElementById("modal-text");
const modalAuthor = document.getElementById("modal-author");
const modalDate = document.getElementById("modal-date");
const closeBtn = document.querySelector(".modal .close");

// Funci√≥n para abrir modal con la info de la nota
function openModal(note) {
  modal.style.display = "flex";
  modalImg.src = note.image || ""; // si tiene imagen
  modalTitle.textContent = note.title;
  modalText.textContent = note.description;
  modalAuthor.textContent = note.author || "";
  modalDate.textContent = note.date || "";
}

// Cerrar modal
closeBtn.onclick = () => modal.style.display = "none";
window.onclick = (e) => { if(e.target == modal) modal.style.display = "none"; };

// Agregar evento a todas las notas
document.querySelectorAll(".note-card").forEach(card => {
  card.addEventListener("click", () => {
    const noteId = card.getAttribute("data-id");
    const note = notas.find(n => n.id == noteId);
    if(note) openModal(note);
  });
});
let revistaModal = document.getElementById("revista-modal");

function openRevistaModal(revista) {
  revistaModal.style.display = "flex";

  document.getElementById("modal-cover").src = revista.cover;
  document.getElementById("modal-title").textContent = revista.title;
  document.getElementById("modal-meta").textContent =
    `N¬∞ ${revista.number} - ${revista.date}`;
  document.getElementById("modal-description").textContent =
    revista.description || "";

  document.getElementById("modal-pdf").href = revista.pdf;
  const btnOnline = document.getElementById("modal-online");

btnOnline.onclick = (e) => {
  e.preventDefault();

  // cerrar modal de revista
  revistaModal.style.display = "none";

  // abrir visor online
  abrirVisorRevista(revista);
};


}
 revistaModal = document.getElementById("revista-modal");

if (revistaModal) {
  const revistaClose = revistaModal.querySelector(".close");

  revistaClose.addEventListener("click", () => {
    revistaModal.style.display = "none";
  });

  window.addEventListener("click", (e) => {
    if (e.target === revistaModal) {
      revistaModal.style.display = "none";
    }
  });

  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      revistaModal.style.display = "none";
    }
  });
}

    // cerrar login al hacer click fuera del formulario
document.getElementById("login-container")?.addEventListener("click", (e) => {
  // si el click es sobre el overlay, no dentro del form
  if (e.target === e.currentTarget) {
    document.getElementById("login-container").style.display = "none";
  }
});
</script>
  </body>
</html>
