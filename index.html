<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bitácora Cultural - Panel de Administración</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <!-- Biblioteca para visualizar PDFs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
      /* RESET Y ESTILOS GENERALES */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Montserrat", sans-serif;
      }

      body {
        background: #f5f7fa;
        color: #333;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      /* HEADER */
      header {
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        color: white;
        padding: 20px 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .logo-image {
        height: 60px;
        max-width: 200px;
      }

      .logo-image img {
        height: 100%;
        max-height: 60px;
        object-fit: contain;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
      }

      .logo p {
        font-size: 14px;
        color: #ff6f61;
        font-style: italic;
      }

      nav ul {
        display: flex;
        list-style: none;
        gap: 25px;
      }

      nav a {
        color: white;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s;
        padding: 8px 15px;
        border-radius: 4px;
      }

      nav a:hover {
        color: #ff6f61;
        background: rgba(255, 255, 255, 0.1);
      }

      .admin-link {
        background: #ff6f61;
        color: white !important;
      }

      .admin-link:hover {
        background: #e55a50;
      }

      /* LOGIN */
      .login-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .login-form {
        background: white;
        padding: 40px;
        border-radius: 10px;
        width: 90%;
        max-width: 400px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .login-form h2 {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 10px;
      }

      .login-form p {
        text-align: center;
        color: #7f8c8d;
        margin-bottom: 30px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #2c3e50;
        font-weight: 500;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 16px;
      }

      .btn {
        display: inline-block;
        background: #ff6f61;
        color: white;
        padding: 12px 30px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        text-align: center;
      }

      .btn:hover {
        background: #e55a50;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(255, 111, 97, 0.3);
      }

      .btn-large {
        padding: 15px 40px;
        font-size: 18px;
      }

      /* PANEL ADMIN */
      #admin-panel {
        display: none;
        min-height: 100vh;
        background: #f5f7fa;
      }

      .admin-header {
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        color: white;
        padding: 20px 0;
        margin-bottom: 30px;
      }

      .admin-nav {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      .tab-btn {
        background: #e9ecef;
        color: #495057;
        border: 2px solid #dee2e6;
        padding: 12px 25px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        font-size: 15px;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .tab-btn:hover {
        background: #dee2e6;
      }

      .tab-btn.active {
        background: #ff6f61;
        color: white;
        border-color: #ff6f61;
      }

      .admin-section {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        margin-bottom: 30px;
        display: none;
      }

      .admin-section.active {
        display: block;
        animation: fadeIn 0.5s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .admin-section h3 {
        color: #2c3e50;
        font-size: 24px;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 3px solid #ff6f61;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      /* FORMULARIO AGREGAR REVISTA */
      .form-row {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
      }

      .form-row .form-group {
        flex: 1;
        margin-bottom: 0;
      }

      textarea {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 16px;
        min-height: 120px;
        resize: vertical;
      }

      /* INPUT DE ARCHIVOS */
      .file-input-container {
        position: relative;
        margin-bottom: 15px;
      }

      .file-input {
        width: 100%;
        padding: 12px 15px;
        border: 2px dashed #ddd;
        border-radius: 6px;
        background: #f9f9f9;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s;
      }

      .file-input:hover {
        border-color: #ff6f61;
        background: #fff9f8;
      }

      .file-input i {
        font-size: 24px;
        color: #ff6f61;
        margin-bottom: 10px;
        display: block;
      }

      .image-preview-container {
        margin-top: 15px;
        text-align: center;
      }

      .image-preview {
        max-width: 100%;
        max-height: 200px;
        border-radius: 6px;
        border: 2px solid #ddd;
        margin-top: 10px;
        display: none;
      }

      .image-preview.active {
        display: inline-block;
      }

      /* LISTA DE REVISTAS - ¡ESTILOS MEJORADOS! */
      .items-list {
        margin-top: 30px;
      }

      .item-card {
        background: white;
        border: 2px solid #e9ecef;
        border-left: 5px solid #ff6f61;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s ease;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
      }

      .item-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 20px rgba(255, 111, 97, 0.1);
        border-color: #ff6f61;
      }

      .item-details-container {
        display: flex;
        align-items: center;
        gap: 20px;
        flex: 1;
      }

      .note-image-small,
      .issue-cover-small {
        width: 80px;
        height: 110px;
        border-radius: 6px;
        overflow: hidden;
        flex-shrink: 0;
        border: 2px solid #ddd;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
      }

      .note-image-small img,
      .issue-cover-small img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .item-content h4 {
        color: #2c3e50;
        font-size: 18px;
        margin-bottom: 8px;
        font-weight: 600;
      }

      .item-content p {
        color: #666;
        font-size: 14px;
        line-height: 1.5;
      }

      .category-badge {
        display: inline-block;
        background: #3498db;
        color: white;
        padding: 3px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        margin-right: 8px;
        margin-top: 5px;
      }

      /* BOTONES DE ACCIÓN - ¡MUY VISIBLES! */
      .item-actions-group {
        display: flex;
        gap: 12px;
        flex-shrink: 0;
      }

      .action-btn {
        padding: 10px 18px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        text-decoration: none;
        min-width: 100px;
        justify-content: center;
      }

      .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      }

      .btn-view {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
      }

      .btn-edit {
        background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
        color: #333;
      }

      .btn-delete {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
      }

      /* MODAL */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 2000;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 10px;
        width: 90%;
        max-width: 500px;
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-content h2 {
        color: #2c3e50;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #ff6f61;
      }

      .modal-close {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #7f8c8d;
      }

      /* REVISTA ACTUAL EN VISTA PÚBLICA */
      .current-issue {
        padding: 60px 0;
        background: white;
      }

      .section-title {
        text-align: center;
        color: #2c3e50;
        font-size: 32px;
        margin-bottom: 40px;
        font-weight: 700;
      }

      .issue-container {
        display: flex;
        gap: 40px;
        align-items: flex-start;
      }

      .issue-cover {
        flex: 0 0 300px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .issue-cover img {
        width: 100%;
        height: auto;
        display: block;
      }

      .issue-content {
        flex: 1;
      }

      .issue-content h3 {
        color: #2c3e50;
        font-size: 28px;
        margin-bottom: 15px;
      }

      .issue-meta {
        color: #ff6f61;
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 20px;
      }

      .issue-description {
        font-size: 16px;
        line-height: 1.6;
        color: #555;
        margin-bottom: 30px;
      }

      .issue-actions {
        display: flex;
        gap: 15px;
      }

      .btn-outline {
        background: transparent;
        border: 2px solid #ff6f61;
        color: #ff6f61;
      }

      .btn-outline:hover {
        background: #ff6f61;
        color: white;
      }

      /* MODAL PARA VER REVISTA EN LÍNEA */
      .magazine-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        display: none;
        z-index: 3000;
        overflow: hidden;
      }

      .magazine-header {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        background: rgba(44, 62, 80, 0.9);
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 3001;
      }

      .magazine-header h3 {
        margin: 0;
        font-size: 18px;
      }

      .close-magazine {
        background: #ff6f61;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .close-magazine:hover {
        background: #e55a50;
      }

      .magazine-container {
        position: absolute;
        top: 70px;
        left: 0;
        width: 100%;
        height: calc(100% - 70px);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .pdf-viewer-container {
        width: 100%;
        height: 100%;
        max-width: 1200px;
        background: #2c3e50;
        border-radius: 8px;
        overflow: hidden;
        position: relative;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      }

      .pdf-controls {
        position: absolute;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 10px;
        z-index: 10;
        background: rgba(255, 255, 255, 0.9);
        padding: 10px;
        border-radius: 6px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
      }

      .pdf-controls button {
        background: #2c3e50;
        color: white;
        border: none;
        width: 40px;
        height: 40px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 16px;
        transition: all 0.3s;
      }

      .pdf-controls button:hover {
        background: #ff6f61;
        transform: scale(1.05);
      }

      .pdf-controls select {
        padding: 8px 12px;
        border-radius: 4px;
        border: 1px solid #ddd;
        background: white;
        font-size: 14px;
      }

      .pdf-canvas-container {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: auto;
        padding: 20px;
      }

      .pdf-canvas-container canvas {
        max-width: 100%;
        max-height: 100%;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        border-radius: 4px;
      }

      .page-counter {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(44, 62, 80, 0.9);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 14px;
        font-weight: 500;
      }

      .loading-pdf {
        color: white;
        font-size: 18px;
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 15px;
      }

      .loading-pdf i {
        font-size: 40px;
        color: #ff6f61;
      }

      .loading-pdf p {
        margin: 0;
      }

      /* RESPONSIVE */
      @media (max-width: 1500px) {
        .header-content {
          flex-direction: column;
          gap: 15px;
        }

        nav ul {
          flex-wrap: wrap;
          justify-content: center;
        }

        .issue-container {
          flex-direction: column;
        }

        .issue-cover {
          flex: 0 0 auto;
          width: 100%;
          max-width: 300px;
          margin: 0 auto;
        }

        .item-card {
          flex-direction: column;
          gap: 15px;
          text-align: center;
        }

        .item-details-container {
          flex-direction: column;
          text-align: center;
        }

        .item-actions-group {
          width: 100%;
          justify-content: center;
          flex-wrap: wrap;
        }

        .form-row {
          flex-direction: column;
        }

        .pdf-controls {
          flex-direction: column;
          align-items: center;
          top: 10px;
          right: 10px;
        }

        .magazine-header {
          flex-direction: column;
          gap: 10px;
          padding: 10px;
        }

        .magazine-container {
          top: 120px;
          height: calc(100% - 120px);
        }
      }

      @media (max-width: 1500px) {
        .pdf-controls {
          position: relative;
          top: 0;
          right: 0;
          width: 100%;
          justify-content: center;
          margin-bottom: 10px;
          background: transparent;
          box-shadow: none;
        }

        .pdf-controls button,
        .pdf-controls select {
          width: 35px;
          height: 35px;
          font-size: 14px;
        }
      }
      #pdf-canvas-container {
  display: flex;
  justify-content: center;
  gap: 0;
  perspective: 2000px;
  transform-style: preserve-3d;
}

#pdf-canvas-container canvas {
  margin: 0;
  transition: box-shadow 2.2s ease;
}

/* Animaciones */
#pdf-canvas-container.flip-next {
  animation: flipNext 1.2s ease;
}

#pdf-canvas-container.flip-prev {
  animation: flipPrev 1.2s ease;
}
#pdf-canvas-container.slide-next {
  animation: slideNext 1.2s ease;
}

#pdf-canvas-container.slide-prev {
  animation: slidePrev 1.2s ease;
}
/* Transición desktop */
#pdf-canvas-container {
  transition: transform 0.35s ease, opacity 0.35s ease;
}

#pdf-canvas-container.fade-out {
  opacity: 0;
  transform: translateX(-20px);
}

#pdf-canvas-container.fade-in {
  opacity: 1;
  transform: translateX(0);
}


@keyframes flipNext {
  0% {
    transform: rotateY(0deg);
  }
  100% {
    transform: rotateY(-12deg);
  }
}

@keyframes flipPrev {
  0% {
    transform: rotateY(0deg);
  }
  100% {
    transform: rotateY(12deg);
  }
}
@media (max-width: 1500px) {
  #pdf-canvas-container {
    justify-content: center;
  }

  #pdf-canvas-container canvas {
    max-width: 95vw;
    height: auto;
  }
}

/* Animaciones mobile */
#pdf-canvas-container.slide-next {
  animation: slideNext 0.3s ease;
}

#pdf-canvas-container.slide-prev {
  animation: slidePrev 0.3s ease;
}

@keyframes slideNext {
  from {
    transform: translateX(20px);
    opacity: 0.8;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes slidePrev {
  from {
    transform: translateX(-20px);
    opacity: 0.8;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}
@media (max-width: 1500px) {
  #zoom-select,
  #rotate-left,
  #rotate-right,
  #fullscreen-btn {
    display: none !important;
  }

  .pdf-controls {
    justify-content: space-between;
    gap: 0;
  }

  .pdf-controls button {
    flex: 1;
    font-size: 18px;
    padding: 12px 0;
  }

  .page-counter {
    font-size: 14px;
    margin-top: 10px;
  }

  /* =========================
   MODO LECTOR MOBILE
========================= */
@media (max-width: 1500px) {

  /* Modal ocupa toda la pantalla */
  #magazine-modal {
    padding: 0;
  }

  .magazine-container {
    height: 100vh;
    padding: 0;
  }

  /* Ocultamos header feo */
  .magazine-header {
    display: none;
  }

  /* Contenedor del PDF */
  .pdf-canvas-container {
    height: 100vh;
    width: 100vw;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #0f172a; /* fondo elegante */
  }

  canvas {
    max-width: 100%;
    max-height: 100%;
    margin: 0 auto;
  }

  /* Ocultamos controles innecesarios */
  .pdf-controls select,
  #rotate-left,
  #rotate-right,
  #fullscreen-btn {
    display: none;
  }

  /* Flechas flotantes */
  #prev-page,
  #next-page {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    z-index: 1000;
    background: rgba(0,0,0,.4);
    border-radius: 50%;
    width: 48px;
    height: 48px;
  }

  #prev-page {
    left: 10px;
  }

  #next-page {
    right: 10px;
  }

  /* Ocultamos contador si querés */
  .page-counter {
    display: none;
  }
}
/* =========================
   FIX VISOR PDF – MOBILE SIN BORDES
========================= */
@media (max-width: 1500px) {

  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
  }

  /* Modal ocupa TODO */
  #magazine-modal {
    inset: 0;
    padding: 0;
  }

  /* Contenedor principal */
  .magazine-container {
    width: 100vw;
    height: 100vh;
    margin: 0;
    padding: 0;
    border-radius: 0 !important;
    background: #0f172a;
  }

  /* Viewer intermedio */
  .pdf-viewer-container {
    width: 100vw;
    height: 100vh;
    margin: 0;
    padding: 0;
    border-radius: 0 !important;
    background: #0f172a;
  }

  /* Contenedor de canvases */
  .pdf-canvas-container {
    width: 100vw;
    height: 100vh;
    margin: 0;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #0f172a;
    overflow: hidden;
  }

  /* El PDF en sí */
  .pdf-canvas-container canvas {
    width: 100vw !important;
    height: auto !important;
    max-height: 100vh !important;
    margin: 0 !important;
    padding: 0 !important;
    box-shadow: none !important;
    border-radius: 0 !important;
    background: white;
  }
}
@media (max-width: 1500px) {

  .pdf-canvas-container {
    align-items: flex-start !important; /* ⬅️ CLAVE */
    padding-top: 0 !important;
  }

  .pdf-canvas-container canvas {
    margin-top: 0 !important;
    align-self: flex-start;
  }
}

}

    </style>
  </head>
  <body>
    <!-- LOGIN -->
    <div id="login-container" class="login-container">
      <div class="login-form">
        <h2>Bitácora Cultural</h2>
        <p>Panel de Administración</p>
        <div class="form-group">
          <label for="username">Usuario</label>
          <input type="text" id="username" placeholder="admin" />
        </div>
        <div class="form-group">
          <label for="password">Contraseña</label>
          <input type="password" id="password" placeholder="admin" />
        </div>
        <button class="btn btn-large" id="login-btn" style="width: 100%">
          Iniciar Sesión
        </button>
      </div>
    </div>

    <!-- VISTA PÚBLICA -->
    <div id="public-view">
      <header>
        <div class="container">
          <div class="header-content">
            <div class="logo">
              <div class="logo-image">
                <img
                  src="..//bitacoracultural/titulo.jpeg"
                  alt="Bitácora Cultural Logo"
                />
              </div>
              <p>Revista Cultural Digital</p>
            </div>
            <nav>
              <ul>
                <li><a href="#inicio">Inicio</a></li>
                <li><a href="#revista">Revista Actual</a></li>
                <li><a href="#anteriores">Revistas Anteriores</a></li>
                <li><a href="#categorias">Categorías</a></li>
                <li>
                  <a href="#" id="admin-toggle" class="admin-link">Admin</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </header>

      <!-- REVISTA ACTUAL -->
      <section class="current-issue" id="revista">
        <div class="container">
          <h2 class="section-title">Revista Actual</h2>
          <div class="issue-container">
            <div class="issue-cover">
              <img id="current-cover" src="" alt="Portada Revista Actual" />
            </div>
            <div class="issue-content">
              <h3 id="current-title"></h3>
              <p class="issue-meta" id="current-meta"></p>
              <p class="issue-description" id="current-description"></p>
              <div class="issue-actions">
                <a href="#" id="current-pdf" class="btn" target="_blank">
                  <i class="fas fa-download"></i> Descargar PDF
                </a>
                <a href="#" id="view-magazine-btn" class="btn btn-outline">
                  <i class="fas fa-eye"></i> Ver Revista Online
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- MODAL PARA VER REVISTA ONLINE -->
      <div id="magazine-modal" class="magazine-modal-overlay">
        <div class="magazine-header">
          <h3 id="magazine-title">Revista Online</h3>
          <button class="close-magazine" id="close-magazine">
            <i class="fas fa-times"></i> Cerrar
          </button>
        </div>
        <div class="magazine-container">
          <div class="pdf-viewer-container">
            <div class="pdf-controls">
              <button id="prev-page" title="Página Anterior">
                <i class="fas fa-chevron-left"></i>
              </button>
              <button id="next-page" title="Página Siguiente">
                <i class="fas fa-chevron-right"></i>
              </button>
              <select id="zoom-select">
                <option value="0.5">50%</option>
                <option value="0.75">75%</option>
                <option value="1" selected>100%</option>
                <option value="1.25">125%</option>
                <option value="1.5">150%</option>
                <option value="2">200%</option>
              </select>
              <button id="rotate-left" title="Rotar Izquierda">
                <i class="fas fa-redo"></i>
              </button>
              <button id="rotate-right" title="Rotar Derecha">
                <i class="fas fa-undo"></i>
              </button>
              <button id="fullscreen-btn" title="Pantalla Completa">
                <i class="fas fa-expand"></i>
              </button>
            </div>
            <div class="pdf-canvas-container" id="pdf-canvas-container">
  <canvas id="page-left"></canvas>
  <canvas id="page-right"></canvas>

  <div class="loading-pdf" id="loading-pdf">
    <i class="fas fa-spinner fa-spin"></i>
    <p>Cargando revista...</p>
  </div>
</div>


  <div class="pdf-book" id="pdf-book">
    <canvas id="page-left"></canvas>
    <canvas id="page-right"></canvas>
  </div>
</div>

            <div class="page-counter" id="page-counter">
              Página <span id="current-page">1</span> de
              <span id="total-pages">1</span>
            </div>
          </div>
        </div>
      </div>

      <!-- OTRAS SECCIONES -->
      <section
        class="past-issues"
        id="anteriores"
        style="padding: 60px 0; background: #f5f7fa"
      >
        <div class="container">
          <h2 class="section-title">Revistas Anteriores</h2>
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
              gap: 20px;
              margin-top: 30px;
            "
          >
            <!-- Revistas anteriores se cargarán aquí -->
          </div>
        </div>
      </section>

      <footer
        style="
          background: #2c3e50;
          color: white;
          padding: 40px 0;
          text-align: center;
        "
      >
        <div class="container">
          <p>&copy; 2026 Bitácora Cultural. Todos los derechos reservados.</p>
        </div>
      </footer>
    </div>

    <!-- PANEL DE ADMINISTRACIÓN -->
    <div id="admin-panel">
      <div class="admin-header">
        <div class="container">
          <div class="header-content">
            <div class="logo">
              <h1>Panel de Administración</h1>
              <p>Bitácora Cultural</p>
            </div>
            <nav>
              <ul>
                <li><a href="#" id="public-toggle">Volver al Sitio</a></li>
                <li><a href="#" id="logout-btn">Cerrar Sesión</a></li>
              </ul>
            </nav>
          </div>
        </div>
      </div>

      <div class="container">
        <!-- NAVEGACIÓN DE TABS -->
        <div class="admin-nav">
          <button class="tab-btn active" data-tab="revistas">
            <i class="fas fa-newspaper"></i> Gestionar Revistas
          </button>
          <button class="tab-btn" data-tab="categorias">
            <i class="fas fa-tags"></i> Gestionar Categorías
          </button>
          <button class="tab-btn" data-tab="notas">
            <i class="fas fa-file-alt"></i> Gestionar Notas
          </button>
        </div>

        <!-- TAB: GESTIONAR REVISTAS -->
        <div class="admin-section active" id="revistas">
          <h3><i class="fas fa-newspaper"></i> Gestionar Revistas</h3>

          <!-- Formulario para agregar revista -->
          <div class="form-row">
            <div class="form-group">
              <label for="issue-number">Número de Revista</label>
              <input type="number" id="issue-number" min="1" value="16" />
            </div>
            <div class="form-group">
              <label for="issue-month">Mes</label>
              <select id="issue-month">
                <option value="enero">Enero</option>
                <option value="febrero">Febrero</option>
                <option value="marzo" selected>Marzo</option>
                <option value="abril">Abril</option>
                <option value="mayo">Mayo</option>
                <option value="junio">Junio</option>
                <option value="julio">Julio</option>
                <option value="agosto">Agosto</option>
                <option value="septiembre">Septiembre</option>
                <option value="octubre">Octubre</option>
                <option value="noviembre">Noviembre</option>
                <option value="diciembre">Diciembre</option>
              </select>
            </div>
            <div class="form-group">
              <label for="issue-year">Año</label>
              <input
                type="number"
                id="issue-year"
                value="2026"
                min="2020"
                max="2030"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="issue-title">Título</label>
            <input
              type="text"
              id="issue-title"
              placeholder="Título de la revista"
            />
          </div>

          <div class="form-group">
            <label for="issue-description">Descripción</label>
            <textarea
              id="issue-description"
              placeholder="Descripción de la revista"
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Portada de Revista</label>
              <div class="file-input-container">
                <label class="file-input" for="issue-cover-input">
                  <i class="fas fa-image"></i>
                  <span>Haz clic para seleccionar portada</span>
                  <input
                    type="file"
                    id="issue-cover-input"
                    accept="image/*"
                    style="display: none"
                  />
                </label>
                <div class="image-preview-container">
                  <img
                    id="issue-cover-preview"
                    class="image-preview"
                    alt="Vista previa de portada"
                  />
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="issue-pdf">Archivo PDF (opcional)</label>
              <div class="file-input-container">
                <label class="file-input" for="issue-pdf-input">
                  <i class="fas fa-file-pdf"></i>
                  <span>Haz clic para seleccionar PDF</span>
                  <input
                    type="file"
                    id="issue-pdf-input"
                    accept=".pdf"
                    style="display: none"
                  />
                </label>
                <span
                  id="pdf-file-name"
                  style="
                    font-size: 14px;
                    color: #666;
                    margin-top: 5px;
                    display: block;
                  "
                ></span>
              </div>
            </div>
          </div>

          <button class="btn" id="add-issue-btn" style="margin-top: 20px">
            <i class="fas fa-plus"></i> Agregar Nueva Revista
          </button>

          <hr
            style="margin: 40px 0; border: none; border-top: 2px solid #eee"
          />

          <!-- LISTA DE REVISTAS PUBLICADAS -->
          <h4><i class="fas fa-list"></i> Revistas Publicadas</h4>
          <div class="items-list" id="issues-list">
            <!-- Las revistas se cargarán aquí dinámicamente -->
          </div>
        </div>

        <!-- TAB: GESTIONAR CATEGORÍAS -->
        <div class="admin-section" id="categorias">
          <h3><i class="fas fa-tags"></i> Gestionar Categorías</h3>
          <div class="form-group">
            <label for="category-name">Nombre de Categoría</label>
            <input type="text" id="category-name" placeholder="Ej: Música" />
          </div>
          <div class="form-group">
            <label for="category-description">Descripción</label>
            <textarea
              id="category-description"
              placeholder="Descripción de la categoría"
            ></textarea>
          </div>
          <button class="btn" id="add-category-btn">
            <i class="fas fa-plus"></i> Agregar Categoría
          </button>
          <div class="items-list" id="categories-list"></div>
        </div>

        <!-- TAB: GESTIONAR NOTAS -->
        <div class="admin-section" id="notas">
          <h3><i class="fas fa-file-alt"></i> Gestionar Notas Periodísticas</h3>

          <div class="form-row">
            <div class="form-group">
              <label for="note-title">Título de la Nota</label>
              <input
                type="text"
                id="note-title"
                placeholder="Título de la nota periodística"
              />
            </div>
            <div class="form-group">
              <label for="note-category">Categoría</label>
              <select id="note-category">
                <!-- Se llenará dinámicamente con las categorías -->
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="note-description">Descripción / Resumen</label>
            <textarea
              id="note-description"
              placeholder="Resumen de la nota periodística"
              rows="3"
            ></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Imagen de la Nota</label>
              <div class="file-input-container">
                <label class="file-input" for="note-image-input">
                  <i class="fas fa-camera"></i>
                  <span>Haz clic para seleccionar imagen</span>
                  <input
                    type="file"
                    id="note-image-input"
                    accept="image/*"
                    style="display: none"
                  />
                </label>
                <div class="image-preview-container">
                  <img
                    id="note-image-preview"
                    class="image-preview"
                    alt="Vista previa de imagen"
                  />
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="note-author">Autor</label>
              <input
                type="text"
                id="note-author"
                placeholder="Nombre del autor"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="note-content">Contenido Completo</label>
            <textarea
              id="note-content"
              placeholder="Contenido completo de la nota periodística..."
              rows="6"
            ></textarea>
          </div>

          <button class="btn" id="add-note-btn">
            <i class="fas fa-plus"></i> Agregar Nota Periodística
          </button>

          <hr style="margin: 30px 0; border-top: 1px solid #eee" />

          <h4><i class="fas fa-list"></i> Notas Publicadas</h4>
          <div class="items-list" id="notes-list"></div>
        </div>
      </div>
    </div>

    <!-- MODAL PARA EDITAR REVISTA -->
    <div id="edit-issue-modal" class="modal-overlay">
      <div class="modal-content">
        <button class="modal-close" id="close-edit-modal">&times;</button>
        <h2><i class="fas fa-edit"></i> Editar Revista</h2>

        <div class="form-group">
          <label for="edit-issue-number">Número</label>
          <input type="number" id="edit-issue-number" min="1" />
        </div>

        <div class="form-group">
          <label for="edit-issue-month">Mes</label>
          <select id="edit-issue-month">
            <option value="enero">Enero</option>
            <option value="febrero">Febrero</option>
            <option value="marzo">Marzo</option>
            <option value="abril">Abril</option>
            <option value="mayo">Mayo</option>
            <option value="junio">Junio</option>
            <option value="julio">Julio</option>
            <option value="agosto">Agosto</option>
            <option value="septiembre">Septiembre</option>
            <option value="octubre">Octubre</option>
            <option value="noviembre">Noviembre</option>
            <option value="diciembre">Diciembre</option>
          </select>
        </div>

        <div class="form-group">
          <label for="edit-issue-year">Año</label>
          <input type="number" id="edit-issue-year" min="2020" max="2030" />
        </div>

        <div class="form-group">
          <label for="edit-issue-title">Título</label>
          <input type="text" id="edit-issue-title" />
        </div>

        <div class="form-group">
          <label for="edit-issue-description">Descripción</label>
          <textarea id="edit-issue-description" rows="4"></textarea>
        </div>

        <div class="form-group">
          <label>Portada de Revista</label>
          <div class="file-input-container">
            <label class="file-input" for="edit-issue-cover-input">
              <i class="fas fa-image"></i>
              <span>Haz clic para cambiar portada</span>
              <input
                type="file"
                id="edit-issue-cover-input"
                accept="image/*"
                style="display: none"
              />
            </label>
            <div class="image-preview-container">
              <img
                id="edit-issue-cover-preview"
                class="image-preview"
                alt="Vista previa de portada"
              />
            </div>
          </div>
        </div>

        <button
          type="button"
          class="btn"
          id="save-edit-btn"
          style="margin-top: 20px; width: 100%"
        >
          <i class="fas fa-save"></i> Guardar Cambios
        </button>
      </div>
    </div>

    <!-- MODAL PARA EDITAR NOTA -->
    <div id="edit-note-modal" class="modal-overlay">
      <div class="modal-content">
        <button class="modal-close" id="close-note-modal">&times;</button>
        <h2><i class="fas fa-edit"></i> Editar Nota Periodística</h2>

        <div class="form-group">
          <label for="edit-note-title">Título de la Nota</label>
          <input type="text" id="edit-note-title" />
        </div>

        <div class="form-group">
          <label for="edit-note-category">Categoría</label>
          <select id="edit-note-category">
            <!-- Se llenará dinámicamente -->
          </select>
        </div>

        <div class="form-group">
          <label for="edit-note-description">Descripción / Resumen</label>
          <textarea id="edit-note-description" rows="3"></textarea>
        </div>

        <div class="form-group">
          <label>Imagen de la Nota</label>
          <div class="file-input-container">
            <label class="file-input" for="edit-note-image-input">
              <i class="fas fa-camera"></i>
              <span>Haz clic para cambiar imagen</span>
              <input
                type="file"
                id="edit-note-image-input"
                accept="image/*"
                style="display: none"
              />
            </label>
            <div class="image-preview-container">
              <img
                id="edit-note-image-preview"
                class="image-preview"
                alt="Vista previa de imagen"
              />
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="edit-note-author">Autor</label>
          <input type="text" id="edit-note-author" />
        </div>

        <div class="form-group">
          <label for="edit-note-content">Contenido Completo</label>
          <textarea id="edit-note-content" rows="6"></textarea>
        </div>

        <button
          type="button"
          class="btn"
          id="save-note-btn"
          style="margin-top: 20px; width: 100%"
        >
          <i class="fas fa-save"></i> Guardar Cambios
        </button>
      </div>
    </div>

    <script>
      // ============================================
      // SISTEMA DE REVISTAS Y NOTAS - CRUD COMPLETO
      // ============================================

      let revistas = [];
      let categorias = [];
      let notas = [];

      // Variables para el visor de PDF
      let pageRendering = false;
      let pageNumPending = null;
      let currentPdfUrl = null;
      let pdfDoc = null;
      let currentPage = 1;
      let scale = 1.2;
      let rotation = 0;

      async function cargarDesdeJSON() {
        try {
          // Traer todo desde el backend
          const res = await fetch("./api/getAllData.php");
          const data = await res.json();

          // ============================
          // REVISTAS
          // ============================
          revistas = (data.issues || []).map((issue) => ({
            id: issue.id,
            number: issue.number,
            month: issue.month,
            year: issue.year,
            title: issue.title || "",
            description: issue.description || "",
            cover: issue.cover || "",
            coverData: issue.coverData || issue.cover || "",
            pdf: issue.pdf || "",
            pdfData: issue.pdfData || issue.pdf || "",
            isCurrent: false,
          }));

          if (revistas.length > 0) revistas[0].isCurrent = true;

          // ============================
          // CATEGORÍAS
          // ============================
          categorias = (data.categories || []).map((c) => ({
            id: c.id,
            name: c.name || "",
            description: c.description || "",
            icon: c.icon || "",
          }));

          // ============================
          // NOTAS
          // ============================
          notas = (data.notes || []).map((n) => ({
            id: n.id,
            title: n.title || "",
            category: n.category || null,
            description: (n.content || n.description || "").substring(0, 120),
            content: n.content || n.description || "",
            image: n.image || "",
            imageData: n.imageData || "",
            author: n.author || "Redacción Bitácora Cultural",
            date: n.date || new Date().toISOString().split("T")[0],
            views: n.views || 0,
          }));

          console.log(
            "Revistas:",
            revistas,
            "Categorías:",
            categorias,
            "Notas:",
            notas
          );
        } catch (error) {
          console.error("Error cargando datos desde el backend:", error);
        }
      }

      let revistaEditando = null;
      let notaEditando = null;
      let issueCoverFile = null;
      let issuePdfFile = null;
      let noteImageFile = null;
      let editIssueCoverFile = null;
      let notaEditandoId;
      let editNoteImageFile = null;

      // ============================================
      // FUNCIONES PRINCIPALES
      // ============================================

      // Inicializar la aplicación
      async function initApp() {
        await cargarDesdeJSON();
        cargarRevistas();
        cargarCategorias();
        cargarNotas();
        setupEventListeners();
        initPdfViewer();
      }

      // Cargar revistas en el admin y en la vista pública
      function cargarRevistas() {
        const issuesList = document.getElementById("issues-list");
        if (!issuesList) return;

        // Limpiar lista
        issuesList.innerHTML = "";

        // Ordenar por número (más reciente primero)
        const revistasOrdenadas = [...revistas].sort(
          (a, b) => Number(b.number) - Number(a.number)
        );

        // Cargar cada revista en el admin
        revistasOrdenadas.forEach((revista) => {
          const revistaHTML = crearHTMLRevista(revista);
          issuesList.appendChild(revistaHTML);
        });

        // Cargar revista actual en vista pública
        cargarRevistaActual();

        // Cargar revistas anteriores en vista pública
        cargarRevistasAnteriores();
      }

      // Cargar categorías en los select
      function cargarCategorias() {
        const categorySelect = document.getElementById("note-category");
        const editCategorySelect =
          document.getElementById("edit-note-category");
        const categoriesList = document.getElementById("categories-list");

        if (!categorySelect) return;

        // Limpiar selects
        categorySelect.innerHTML =
          '<option value="">Seleccionar categoría</option>';
        if (editCategorySelect) {
          editCategorySelect.innerHTML =
            '<option value="">Seleccionar categoría</option>';
        }

        // Llenar selects
        categorias.forEach((categoria) => {
          const option = document.createElement("option");
          option.value = categoria.id;
          option.textContent = categoria.name;
          categorySelect.appendChild(option);

          if (editCategorySelect) {
            const option2 = document.createElement("option");
            option2.value = categoria.id;
            option2.textContent = categoria.name;
            editCategorySelect.appendChild(option2);
          }
        });

        // Cargar lista de categorías en el admin
        if (categoriesList) {
          categoriesList.innerHTML = "";
          categorias.forEach((categoria) => {
            const div = document.createElement("div");
            div.className = "item-card";
            div.innerHTML = `
              <div class="item-details-container">
                <div class="item-content">
                  <h4>${categoria.name}</h4>
                  <p>${categoria.description}</p>
                  <span class="category-badge">ID: ${categoria.id}</span>
                </div>
              </div>
              <div class="item-actions-group">
                <button class="action-btn btn-edit" onclick="editarCategoria(${categoria.id})">
                  <i class="fas fa-edit"></i> Editar
                </button>
                <button class="action-btn btn-delete" onclick="eliminarCategoria(${categoria.id})">
                  <i class="fas fa-trash"></i> Eliminar
                </button>
              </div>
            `;
            categoriesList.appendChild(div);
          });
        }
      }

      // Cargar notas en el admin
      function cargarNotas() {
        const notesList = document.getElementById("notes-list");
        if (!notesList) return;

        // Limpiar lista
        notesList.innerHTML = "";

        // Ordenar por fecha (más reciente primero)
        const notasOrdenadas = [...notas].sort(
          (a, b) => new Date(b.date) - new Date(a.date)
        );

        // Cargar cada nota en el admin
        notasOrdenadas.forEach((nota) => {
          const notaHTML = crearHTMLNota(nota);
          notesList.appendChild(notaHTML);
        });
      }

      // Crear HTML para una revista en el admin
      function crearHTMLRevista(revista) {
        const div = document.createElement("div");
        div.className = "item-card";
        div.dataset.id = revista.id;

        div.innerHTML = `
          <div class="item-details-container">
              <div class="issue-cover-small">
                  <img src="${
                    revista.coverData ||
                    "https://dummyimage.com/80x110/cccccc/000000&text=Portada"
                  }" alt="Revista ${revista.number}">
              </div>
              <div class="item-content">
                  <h4>N° ${revista.number} - ${revista.title}</h4>
                  <p><strong>${capitalize(revista.month)} ${
          revista.year
        }</strong> | ${
          revista.isCurrent ? "⭐ Revista Actual" : "📚 Archivada"
        }</p>
                  <p>${revista.description.substring(0, 150)}...</p>
              </div>
          </div>
          <div class="item-actions-group">
              <button class="action-btn btn-view" onclick="verRevista(${
                revista.id
              })">
                  <i class="fas fa-eye"></i> Ver
              </button>
              <button class="action-btn btn-edit" onclick="editarRevista(${
                revista.id
              })">
                  <i class="fas fa-edit"></i> Editar
              </button>
              <button class="action-btn btn-delete" onclick="eliminarRevista(${
                revista.id
              })">
                  <i class="fas fa-trash"></i> Eliminar
              </button>
          </div>
        `;

        return div;
      }

      function getImageSrc(image) {
        if (!image) {
          return "https://dummyimage.com/80x110/cccccc/000000&text=Imagen";
        }

        if (image.startsWith("http") || image.startsWith("./api/uploads")) {
          return image;
        }

        return "./api/uploads/" + image;
      }

      // Crear HTML para una nota en el admin
      function crearHTMLNota(nota) {
        const div = document.createElement("div");
        div.className = "item-card";
        div.dataset.id = nota.id;

        const categoria = categorias.find((c) => c.id === nota.category);
        const categoriaNombre = categoria ? categoria.name : "Sin categoría";
        const categoriaColor = getCategoryColor(nota.category);

        div.innerHTML = `
          <div class="item-details-container">
            <div class="note-image-small">
              <img src="${nota.image}" alt="${nota.title}">
            </div>
            <div class="item-content">
              <h4>${nota.title}</h4>
              <p>${nota.description.substring(0, 120)}...</p>
              <div style="margin-top: 8px;">
                <span class="category-badge" style="background: ${categoriaColor}">${categoriaNombre}</span>
                <span style="font-size: 12px; color: #7f8c8d;">
                  <i class="fas fa-user"></i> ${nota.author} | 
                  <i class="far fa-calendar"></i> ${formatDate(nota.date)} |
                  <i class="fas fa-eye"></i> ${nota.views} vistas
                </span>
              </div>
            </div>
          </div>
          <div class="item-actions-group">
            <button class="action-btn btn-view" onclick="verNota(${nota.id})">
              <i class="fas fa-eye"></i> Ver
            </button>
            <button class="action-btn btn-edit" onclick="editarNota(${
              nota.id
            })">
              <i class="fas fa-edit"></i> Editar
            </button>
            <button class="action-btn btn-delete" onclick="eliminarNota(${
              nota.id
            })">
              <i class="fas fa-trash"></i> Eliminar
            </button>
          </div>
        `;

        return div;
      }

      // Cargar revista actual en vista pública
      function cargarRevistaActual() {
        // Buscar la revista actual, o la última si no hay ninguna seleccionada
        const revistasOrdenadas = [...revistas].sort(
          (a, b) => Number(b.number) - Number(a.number)
        );

        const revistaActual = revistasOrdenadas[0];

        if (!revistaActual) return;

        // Actualizar los elementos del HTML con los datos de la revista actual
        document.getElementById("current-title").textContent =
          revistaActual.title;
        document.getElementById("current-meta").textContent = `N° ${
          revistaActual.number
        } - ${capitalize(revistaActual.month)} ${revistaActual.year}`;
        document.getElementById("current-description").textContent =
          revistaActual.description;
        document.getElementById("current-cover").src =
          revistaActual.cover ||
          "https://via.placeholder.com/300x400?text=Portada+Revista";
        document.getElementById("current-pdf").href = revistaActual.pdf || "#";

        // Configurar el botón para ver revista online
        const viewMagazineBtn = document.getElementById("view-magazine-btn");
        if (viewMagazineBtn && revistaActual.pdf) {
          viewMagazineBtn.onclick = function (e) {
            e.preventDefault();
            abrirVisorRevista(revistaActual);
          };
        }
      }

      // Cargar revistas anteriores en vista pública
      function cargarRevistasAnteriores() {
        const container = document.querySelector(
          ".past-issues .container > div"
        );
        if (!container) return;
        const revistasOrdenadas = [...revistas].sort(
          (a, b) => Number(b.number) - Number(a.number)
        );

        const revistasAnteriores = revistasOrdenadas
          .filter((r) => !r[0])
          .slice(1, 6);
        container.innerHTML = revistasAnteriores
          .map(
            (revista) => `
              <div style="background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,0.1);">
                  <img src="${
                    revista.coverData ||
                    "https://via.placeholder.com/200x150?text=Revista"
                  }" alt="Revista ${
              revista.number
            }" style="width: 100%; height: 150px; object-fit: cover;">
                  <div style="padding: 15px;">
                      <h4 style="font-size: 14px; margin-bottom: 5px; color: #2c3e50;">N° ${
                        revista.number
                      }</h4>
                      <p style="font-size: 12px; color: #ff6f61; margin-bottom: 5px;">${capitalize(
                        revista.month
                      )} ${revista.year}</p>
                      <p style="font-size: 12px; color: #666;">${revista.title.substring(
                        0,
                        50
                      )}...</p>
                  </div>
              </div>
          `
          )
          .join("");
      }

      // ============================================
      // FUNCIONES PARA MANEJAR ARCHIVOS
      // ============================================

      // Convertir archivo a Base64
      function fileToBase64(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.readAsDataURL(file);
          reader.onload = () => resolve(reader.result);
          reader.onerror = (error) => reject(error);
        });
      }

      // Mostrar vista previa de imagen
      function showImagePreview(input, previewId) {
        const file = input.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (e) {
            const preview = document.getElementById(previewId);
            preview.src = e.target.result;
            preview.classList.add("active");
          };
          reader.readAsDataURL(file);
        }
      }

      // ============================================
      // VISOR DE PDF - REVISTA ONLINE
      // ============================================
function isMobile() {
  return window.innerWidth <= 1500;
}

      function initPdfViewer() {
        // Configurar evento para cerrar revista
        document
          .getElementById("close-magazine")
          .addEventListener("click", function () {
            document.getElementById("magazine-modal").style.display = "none";
            if (pdfDoc) {
              pdfDoc.destroy();
              pdfDoc = null;
            }
          });

      document.getElementById("next-page").addEventListener("click", async () => {
  if (!pdfDoc) return;

  const container = document.getElementById("pdf-canvas-container");

  if (isMobile()) {
    if (currentPage + 1 > pdfDoc.numPages) return;

    container.classList.add("slide-next");

    setTimeout(async () => {
      container.classList.remove("slide-next");
      currentPage += 1;
      await renderSinglePage(currentPage);
    }, 300);

  } else {
    if (currentPage + 2 > pdfDoc.numPages) return;

    container.classList.add("flip-next");

    setTimeout(async () => {
      container.classList.remove("flip-next");
      currentPage += 2;
      await renderTwoPagesWithTransition(currentPage, "next");
    }, 500);
  }
});

document.getElementById("prev-page").addEventListener("click", async () => {
  if (!pdfDoc) return;

  const container = document.getElementById("pdf-canvas-container");

  if (isMobile()) {
    if (currentPage - 1 < 1) return;

    container.classList.add("slide-prev");

    setTimeout(async () => {
      container.classList.remove("slide-prev");
      currentPage -= 1;
      await renderSinglePage(currentPage);
    }, 300);

  } else {
    if (currentPage - 2 < 1) return;

    container.classList.add("flip-prev");

    setTimeout(async () => {
      container.classList.remove("flip-prev");
      currentPage -= 2;
      await renderTwoPagesWithTransition(currentPage, "prev");
    }, 500);
  }
});



        document
          .getElementById("zoom-select")
          .addEventListener("change", function () {
            scale = parseFloat(this.value);
            renderTwoPages(currentPage);          });

        document
          .getElementById("rotate-left")
          .addEventListener("click", function () {
            rotation -= 90;
            renderTwoPages(currentPage);          });

        document
          .getElementById("rotate-right")
          .addEventListener("click", function () {
            rotation += 90;
            renderTwoPages(currentPage);
          });

        document
          .getElementById("fullscreen-btn")
          .addEventListener("click", function () {
            const container = document.querySelector(".pdf-viewer-container");
            if (!document.fullscreenElement) {
              if (container.requestFullscreen) {
                container.requestFullscreen();
              } else if (container.webkitRequestFullscreen) {
                container.webkitRequestFullscreen();
              } else if (container.msRequestFullscreen) {
                container.msRequestFullscreen();
              }
            } else {
              if (document.exitFullscreen) {
                document.exitFullscreen();
              } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
              } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
              }
            }
          });

        // Cerrar con Escape
        document.addEventListener("keydown", function (e) {
          if (
            e.key === "Escape" &&
            document.getElementById("magazine-modal").style.display === "block"
          ) {
            document.getElementById("magazine-modal").style.display = "none";
            if (pdfDoc) {
              pdfDoc.destroy();
              pdfDoc = null;
            }
          }
        });
      }

      function abrirVisorRevista(revista) {
        if (!revista || !revista.pdf) {
          alert("Esta revista no tiene un PDF disponible para ver en línea.");
          return;
        }

        // Mostrar modal
        const modal = document.getElementById("magazine-modal");
        modal.style.display = "block";
        document.getElementById(
          "magazine-title"
        ).textContent = `${revista.title} - N° ${revista.number}`;

        // Mostrar loader
        document.getElementById("loading-pdf").style.display = "flex";

        // Obtener URL del PDF (usar la ruta correcta del backend)
        const pdfUrl = revista.pdf.startsWith("http")
          ? revista.pdf
          : `${revista.pdf}`;
        currentPdfUrl = pdfUrl;

        // Cargar PDF con pdf.js
        pdfjsLib.GlobalWorkerOptions.workerSrc =
          "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

        // Limpiar contenedor anterior
        const container = document.getElementById("pdf-canvas-container");
        container.innerHTML =
          '<div class="loading-pdf" id="loading-pdf"><i class="fas fa-spinner fa-spin"></i><p>Cargando revista...</p></div>';

        // Cargar el PDF
        const loadingTask = pdfjsLib.getDocument(pdfUrl);
        loadingTask.promise
          .then(function (pdf) {
            pdfDoc = pdf;
            document.getElementById("total-pages").textContent = pdf.numPages;
            currentPage = 1;

            // Ocultar loader
            document.getElementById("loading-pdf").style.display = "none";

            // Renderizar primera página
            cargarPDFLibro(pdfUrl);
          })
          .catch(function (error) {
            console.error("Error al cargar el PDF:", error);
            document.getElementById("loading-pdf").innerHTML =
              '<p style="color: #ff6f61;">Error al cargar la revista. Asegúrate de que el archivo PDF sea válido.</p>';
          });
      }

    // ============================================
// VISOR PDF DOBLE PÁGINA (TIPO LIBRO)
// ============================================



const canvasLeft = document.getElementById("page-left");
const canvasRight = document.getElementById("page-right");
const ctxLeft = canvasLeft.getContext("2d");
const ctxRight = canvasRight.getContext("2d");

pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
async function renderSinglePage(pageNum) {
  if (!pdfDoc) return;

  const container = document.getElementById("pdf-canvas-container");
  container.innerHTML = "";

  const page = await pdfDoc.getPage(pageNum);
  const viewport = page.getViewport({ scale: 1.1, rotation });

  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  canvas.width = viewport.width;
  canvas.height = viewport.height;

  canvas.style.background = "#fff";
  canvas.style.boxShadow = "0 8px 25px rgba(0,0,0,.25)";
  canvas.style.borderRadius = "8px";

  container.appendChild(canvas);

  await page.render({
    canvasContext: ctx,
    viewport
  }).promise;

  document.getElementById("current-page").textContent = pageNum;
  document.getElementById("total-pages").textContent = pdfDoc.numPages;
}

async function renderTwoPages(startPage) {
  if (!pdfDoc) return;

  const container = document.getElementById("pdf-canvas-container");
  container.innerHTML = "";

  for (let i = 0; i < 2; i++) {
    const pageNum = startPage + i;
    if (pageNum > pdfDoc.numPages) break;

    const page = await pdfDoc.getPage(pageNum);
    const viewport = page.getViewport({ scale, rotation });

    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = viewport.width;
    canvas.height = viewport.height;

    canvas.style.background = "#fff";
    canvas.style.boxShadow = "0 0 10px rgba(0,0,0,.4)";

    container.appendChild(canvas);

    await page.render({
      canvasContext: ctx,
      viewport
    }).promise;
  }

  document.getElementById("current-page").textContent = startPage;
  document.getElementById("total-pages").textContent = pdfDoc.numPages;
}
function renderTwoPagesWithTransition(startPage, direction = "next") {
  const container = document.getElementById("pdf-canvas-container");

  // animación de salida
  container.classList.remove("fade-in");
  container.classList.add("fade-out");

  setTimeout(async () => {
    await renderTwoPages(startPage);

    // animación de entrada
    container.classList.remove("fade-out");
    container.classList.add("fade-in");
  }, 180);
}

async function cargarPDFLibro(pdfUrl) {
  const loadingTask = pdfjsLib.getDocument(pdfUrl);
  pdfDoc = await loadingTask.promise;
  currentPage = 1;

  if (isMobile()) {
    renderSinglePage(currentPage);
  } else {
    renderTwoPages(currentPage);
  }
}


      // ============================================
      // CRUD - REVISTAS
      // ============================================

      // CREAR - Agregar nueva revista conectada al backend
      async function agregarRevista() {
        const number = document.getElementById("issue-number").value;
        const month = document.getElementById("issue-month").value;
        const year = document.getElementById("issue-year").value;
        const title = document.getElementById("issue-title").value;
        const description = document.getElementById("issue-description").value;

        if (!title || !number) {
          alert("Por favor complete el título y número de la revista");
          return;
        }

        if (!issueCoverFile) {
          alert("Por favor seleccione una portada para la revista");
          return;
        }

        try {
          const formData = new FormData();
          formData.append("number", number);
          formData.append("month", month);
          formData.append("year", year);
          formData.append("title", title);
          formData.append("description", description);
          formData.append("cover", issueCoverFile);
          if (issuePdfFile) formData.append("pdf", issuePdfFile);

          const res = await fetch("./api/issues.php", {
            method: "POST",
            body: formData,
          });

          const data = await res.json();

          if (data.status === "success") {
            // Agregar al array local
            revistas.push(data.data);
            cargarRevistas();

            // Limpiar formulario y archivos
            document.getElementById("issue-title").value = "";
            document.getElementById("issue-description").value = "";
            document.getElementById("issue-number").value =
              parseInt(number) + 1;

            issueCoverFile = null;
            issuePdfFile = null;
            document.getElementById("issue-cover-input").value = "";
            document.getElementById("issue-pdf-input").value = "";
            document
              .getElementById("issue-cover-preview")
              .classList.remove("active");
            document.getElementById("pdf-file-name").textContent = "";

            alert(`✅ Revista "${title}" agregada correctamente`);
            console.log("Nueva revista agregada:", data.data);
          } else {
            alert("❌ Error al crear la revista: " + data.message);
          }
        } catch (error) {
          console.error("Error creando revista en backend:", error);
          alert("❌ Error al comunicarse con el servidor");
        }
      }

      // LEER - Ver detalles de revista
      function verRevista(id) {
        const revista = revistas.find((r) => r.id === id);
        if (revista) {
          alert(
            `📖 Revista N° ${revista.number}\n📌 Título: ${
              revista.title
            }\n📅 ${capitalize(revista.month)} ${revista.year}\n\n${
              revista.description
            }`
          );
        }
      }

      // ACTUALIZAR - Editar revista
      // Abrir modal y llenar formulario para editar
      async function editarRevista(id) {
        const revista = revistas.find((r) => r.id === id);
        if (!revista) return;

        revistaEditando = revista;

        document.getElementById("edit-issue-number").value = revista.number;
        document.getElementById("edit-issue-month").value = revista.month;
        document.getElementById("edit-issue-year").value = revista.year;
        document.getElementById("edit-issue-title").value = revista.title;
        document.getElementById("edit-issue-description").value =
          revista.description;

        // Vista previa portada
        const preview = document.getElementById("edit-issue-cover-preview");
        if (revista.coverData) {
          preview.src = revista.coverData;
          preview.classList.add("active");
        } else {
          preview.classList.remove("active");
          preview.src = "";
        }

        // Mostrar modal
        document.getElementById("edit-issue-modal").style.display = "flex";
      }

      // Guardar cambios editados y actualizar backend
      let guardarEdicionRevista;

      guardarEdicionRevista = async (event) => {
        event?.preventDefault?.();
        if (!revistaEditando) return;

        const formData = new FormData();
        formData.append("_method", "PUT");
        formData.append("id", revistaEditando.id);
        formData.append(
          "number",
          document.getElementById("edit-issue-number").value
        );
        formData.append(
          "month",
          document.getElementById("edit-issue-month").value
        );
        formData.append(
          "year",
          document.getElementById("edit-issue-year").value
        );
        formData.append(
          "title",
          document.getElementById("edit-issue-title").value
        );
        formData.append(
          "description",
          document.getElementById("edit-issue-description").value
        );

        if (editIssueCoverFile) formData.append("cover", editIssueCoverFile);

        try {
          const res = await fetch("./api/issues.php", {
            method: "POST",
            body: formData,
          });
          const data = await res.json();

          if (data.status === "success") {
            const index = revistas.findIndex(
              (r) => r.id === revistaEditando.id
            );
            if (index !== -1) {
              revistas[index] = data.data;
              if (editIssueCoverFile) {
                revistas[index].coverData = await fileToBase64(
                  editIssueCoverFile
                );
              }
            }

            cargarRevistas();
            cerrarModalEdicion();
            alert(`✏️ Revista "${data.data.title}" actualizada correctamente`);

            editIssueCoverFile = null;
            document
              .getElementById("edit-issue-cover-preview")
              .classList.remove("active");
            revistaEditando = null;
          } else {
            console.error("Error del backend:", data);
            alert("Error al actualizar la revista");
          }
        } catch (error) {
          console.error("Error en la petición al backend:", error);
          alert("Error al comunicarse con el backend");
        }
      };

      // ELIMINAR - Borrar revista
      async function eliminarRevista(id) {
        const revista = revistas.find((r) => r.id === id);
        if (!revista) return;

        const confirmacion = confirm(
          `¿Está seguro de eliminar la revista N° ${revista.number} - "${revista.title}"?\n\nEsta acción no se puede deshacer.`
        );

        if (!confirmacion) return;

        try {
          // Llamada al backend para eliminar
          const res = await fetch(`./api/issues.php?id=${id}`, {
            method: "DELETE",
          });
          const result = await res.json();

          if (result.status === "success") {
            // Si era la revista actual, asignar otra como actual
            if (revista.isCurrent && revistas.length > 1) {
              const otraRevista = revistas.find((r) => r.id !== id);
              if (otraRevista) otraRevista.isCurrent = true;
            }

            // Eliminar del array local
            revistas = revistas.filter((r) => r.id !== id);

            // Actualizar interfaz
            cargarRevistas();

            alert(`🗑️ Revista "${revista.title}" eliminada correctamente`);
            console.log("Revista eliminada:", revista);
          } else {
            console.error("Error al eliminar revista:", result);
            alert("❌ No se pudo eliminar la revista");
          }
        } catch (error) {
          console.error("Error en la petición al backend:", error);
          alert("❌ Ocurrió un error al eliminar la revista");
        }
      }

      // ============================================
      // CRUD - CATEGORÍAS
      // ============================================

      // Agregar nueva categoría (con backend)
      async function agregarCategoria() {
        const name = document.getElementById("category-name").value;
        const description = document.getElementById(
          "category-description"
        ).value;

        if (!name) {
          alert("Por favor ingrese el nombre de la categoría");
          return;
        }

        const nuevaCategoria = { name, description };

        try {
          const res = await fetch("./api/categories.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(nuevaCategoria),
          });

          const data = await res.json();

          if (data.status === "success") {
            // Agregar al array local y actualizar interfaz
            categorias.push(data.data);
            cargarCategorias();

            // Limpiar formulario
            document.getElementById("category-name").value = "";
            document.getElementById("category-description").value = "";

            alert(`✅ Categoría "${name}" agregada correctamente`);
            console.log("Nueva categoría agregada:", data.data);
          } else {
            alert("❌ Error al agregar categoría");
            console.error(data);
          }
        } catch (error) {
          console.error("Error conectando al backend:", error);
          alert("❌ Error al conectar con el servidor");
        }
      }

      // Editar categoría (con backend)
      async function editarCategoria(id) {
        const categoria = categorias.find((c) => c.id === id);
        if (!categoria) return;

        const nuevoNombre = prompt(
          "Nuevo nombre de la categoría:",
          categoria.name
        );
        if (!nuevoNombre || nuevoNombre.trim() === "") return;

        const nuevaDescripcion = prompt(
          "Nueva descripción:",
          categoria.description
        );
        if (nuevaDescripcion === null) return;

        const categoriaActualizada = {
          id: categoria.id,
          name: nuevoNombre.trim(),
          description: nuevaDescripcion,
        };

        try {
          const res = await fetch(`./api/categories.php`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(categoriaActualizada),
          });

          const data = await res.json();

          if (data.status === "success") {
            // Actualizar array local y refrescar interfaz
            categoria.name = categoriaActualizada.name;
            categoria.description = categoriaActualizada.description;
            cargarCategorias();

            alert(`✅ Categoría actualizada correctamente`);
            console.log("Categoría actualizada:", categoriaActualizada);
          } else {
            alert("❌ Error al actualizar categoría");
            console.error(data);
          }
        } catch (error) {
          console.error("Error conectando al backend:", error);
          alert("❌ Error al conectar con el servidor");
        }
      }

      // Eliminar categoría
      async function eliminarCategoria(id) {
        const categoria = categorias.find((c) => c.id === id);
        if (!categoria) return;

        // Verificar si hay notas con esta categoría
        const notasConCategoria = notas.filter((n) => n.category === id);
        if (notasConCategoria.length > 0) {
          alert(
            `No se puede eliminar la categoría "${categoria.name}" porque tiene ${notasConCategoria.length} nota(s) asociada(s).\n\nPrimero debe reasignar o eliminar esas notas.`
          );
          return;
        }

        const confirmacion = confirm(
          `¿Está seguro de eliminar la categoría "${categoria.name}"?\n\nEsta acción no se puede deshacer.`
        );
        if (!confirmacion) return;

        try {
          const res = await fetch(`./api/categories.php?id=${id}`, {
            method: "DELETE",
          });
          const result = await res.json();

          if (result.status === "success") {
            // Eliminar del array local
            categorias = categorias.filter((c) => c.id !== id);

            // Actualizar interfaz
            cargarCategorias();

            alert(`🗑️ Categoría "${categoria.name}" eliminada correctamente`);
            console.log("Categoría eliminada:", categoria);
          } else {
            console.error("Error backend:", result);
            alert("Error eliminando categoría");
          }
        } catch (error) {
          console.error("Error conectando al backend:", error);
          alert("Error conectando al backend");
        }
      }

      // ============================================
      // CRUD - NOTAS PERIODÍSTICAS
      // ============================================

      // CREAR - Agregar nueva nota
      async function agregarNota() {
        const title = document.getElementById("note-title").value.trim();
        const category = parseInt(
          document.getElementById("note-category").value
        );
        const description = document
          .getElementById("note-description")
          .value.trim();
        const content = document.getElementById("note-content").value.trim();
        const author = document.getElementById("note-author").value.trim();

        if (!title || !category || !description) {
          alert("Por favor complete título, categoría y descripción");
          return;
        }

        const categoria = categorias.find((c) => c.id === category);
        if (!categoria) {
          alert("La categoría seleccionada no existe");
          return;
        }

        if (!noteImageFile) {
          alert("Por favor seleccione una imagen");
          return;
        }

        try {
          const formData = new FormData();
          formData.append("title", title);
          formData.append("category", category);
          formData.append("description", description);
          formData.append("content", content || description);
          formData.append("author", author || "Redacción Bitácora Cultural");
          formData.append("imageFile", noteImageFile);

          const res = await fetch("./api/notes.php", {
            method: "POST",
            body: formData,
          });

          const result = await res.json();

          if (!res.ok || result.status !== "success") {
            console.error("Error backend:", result);
            alert("Error agregando la nota");
            return;
          }

          // 🔥 USAR LO QUE DEVUELVE EL BACKEND (CLAVE)
          notas.push(result.data);

          cargarNotas();

          // Limpiar formulario
          document.getElementById("note-title").value = "";
          document.getElementById("note-category").value = "";
          document.getElementById("note-description").value = "";
          document.getElementById("note-content").value = "";
          document.getElementById("note-author").value = "";
          document.getElementById("note-image-input").value = "";
          document
            .getElementById("note-image-preview")
            .classList.remove("active");

          noteImageFile = null;

          alert(`✅ Nota "${title}" agregada correctamente`);
          console.log("Nota creada:", result.data);
        } catch (error) {
          console.error("Error conectando al backend:", error);
          alert("Error conectando al backend");
        }
      }

      // LEER - Ver detalles de nota
      function verNota(id) {
        const nota = notas.find((n) => n.id === id);
        if (nota) {
          const categoria = categorias.find((c) => c.id === nota.category);
          const categoriaNombre = categoria ? categoria.name : "Sin categoría";

          alert(
            `📰 ${nota.title}\n\n📌 Categoría: ${categoriaNombre}\n✍️ Autor: ${
              nota.author
            }\n📅 Fecha: ${formatDate(nota.date)}\n👁️ Vistas: ${
              nota.views
            }\n\n${nota.description}\n\n---\n${nota.content.substring(
              0,
              300
            )}...`
          );
        }
      }

      // =========================
      // EDITAR NOTA
      // =========================
      function editarNota(id) {
        const nota = notas.find((n) => n.id === id);
        if (!nota) return;

        notaEditandoId = id;
        editNoteImageFile = null;

        document.getElementById("edit-note-title").value = nota.title;
        document.getElementById("edit-note-category").value = nota.category;
        document.getElementById("edit-note-description").value =
          nota.description;
        document.getElementById("edit-note-author").value = nota.author;
        document.getElementById("edit-note-content").value = nota.content;

        const preview = document.getElementById("edit-note-image-preview");
        preview.src = nota.image || "";
        preview.style.display = nota.image ? "block" : "none";

        document.getElementById("edit-note-modal").style.display = "flex";
      }

      // =========================
      // GUARDAR CAMBIOS DE NOTA
      // =========================
      async function guardarEdicionNota() {
        if (!notaEditandoId) {
          alert("No hay nota en edición");
          return;
        }

        const formData = new FormData();
        formData.append("id", notaEditandoId);
        formData.append(
          "title",
          document.getElementById("edit-note-title").value
        );
        formData.append(
          "category",
          document.getElementById("edit-note-category").value
        );
        formData.append(
          "description",
          document.getElementById("edit-note-description").value
        );
        formData.append(
          "author",
          document.getElementById("edit-note-author").value
        );
        formData.append(
          "content",
          document.getElementById("edit-note-content").value
        );

        // 👉 SOLO si se seleccionó una imagen nueva
        if (editNoteImageFile) {
          formData.append("imageFile", editNoteImageFile);
        }

        try {
          const res = await fetch("./api/notes.php", {
            method: "POST",
            body: formData,
          });

          const data = await res.json();

          if (!data.status) {
            alert("Error al actualizar la nota");
            return;
          }

          document.getElementById("edit-note-modal").style.display = "none";
          notaEditandoId = null;
          editNoteImageFile = null;

          await cargarDesdeJSON();
          cargarNotas();

          alert("✅ Nota actualizada correctamente");
        } catch (error) {
          console.error("Error actualizando nota:", error);
          alert("Error al conectar con el backend");
        }
      }

      // ELIMINAR - Borrar nota
      async function eliminarNota(id) {
        const nota = notas.find((n) => n.id === id);
        if (!nota) return;

        const confirmacion = confirm(
          `¿Está seguro de eliminar la nota "${nota.title}"?\n\nEsta acción no se puede deshacer.`
        );

        if (!confirmacion) return;

        try {
          const res = await fetch(`./api/notes.php?id=${id}`, {
            method: "DELETE",
          });

          const data = await res.json();

          if (!res.ok || data.status !== "success") {
            throw new Error(data.error || "Error al eliminar");
          }

          // Eliminar del estado local
          notas = notas.filter((n) => n.id !== id);

          // Refrescar UI
          cargarNotas();

          alert(`🗑️ Nota "${nota.title}" eliminada correctamente`);
          console.log("Nota eliminada:", nota);
        } catch (error) {
          console.error("Error eliminando nota:", error);
          alert("❌ No se pudo eliminar la nota");
        }
      }

      // ============================================
      // UTILIDADES
      // ============================================

      function capitalize(text) {
        return text.charAt(0).toUpperCase() + text.slice(1);
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("es-ES", {
          day: "2-digit",
          month: "short",
          year: "numeric",
        });
      }

      function getCategoryColor(category) {
        const colors = [
          "#3498db", // Azul
          "#2ecc71", // Verde
          "#e74c3c", // Rojo
          "#9b59b6", // Púrpura
          "#f39c12", // Naranja
          "#1abc9c", // Turquesa
          "#d35400", // Calabaza
          "#34495e", // Gris oscuro
        ];
        return colors[category % colors.length];
      }

      function cerrarModalEdicion() {
        document.getElementById("edit-issue-modal").style.display = "none";
        revistaEditando = null;
        editIssueCoverFile = null;
        document.getElementById("edit-issue-cover-input").value = "";
        document
          .getElementById("edit-issue-cover-preview")
          .classList.remove("active");
      }

      function cerrarModalNota() {
        document
          .getElementById("close-note-modal")
          .addEventListener("click", () => {
            notaEditandoId = null;
            document.getElementById("edit-note-modal").style.display = "none";
          });
      }

      // ============================================
      // EVENT LISTENERS
      // ============================================

      function setupEventListeners() {
        // Login/Logout
        document
          .getElementById("admin-toggle")
          .addEventListener("click", (e) => {
            e.preventDefault();
            document.getElementById("login-container").style.display = "flex";
          });

        document.getElementById("login-btn").addEventListener("click", () => {
          const user = document.getElementById("username").value;
          const pass = document.getElementById("password").value;

          if (user === "admin" && pass === "admin") {
            document.getElementById("login-container").style.display = "none";
            document.getElementById("public-view").style.display = "none";
            document.getElementById("admin-panel").style.display = "block";
          } else {
            alert("Usuario o contraseña incorrectos");
          }
        });

        document
          .getElementById("public-toggle")
          .addEventListener("click", (e) => {
            e.preventDefault();
            document.getElementById("admin-panel").style.display = "none";
            document.getElementById("public-view").style.display = "block";
          });

        document.getElementById("logout-btn").addEventListener("click", (e) => {
          e.preventDefault();
          document.getElementById("admin-panel").style.display = "none";
          document.getElementById("public-view").style.display = "block";
        });

        // Tabs admin
        document.querySelectorAll(".tab-btn").forEach((btn) => {
          btn.addEventListener("click", function () {
            const tabId = this.dataset.tab;

            // Remover active de todos
            document
              .querySelectorAll(".tab-btn")
              .forEach((b) => b.classList.remove("active"));
            document
              .querySelectorAll(".admin-section")
              .forEach((s) => s.classList.remove("active"));

            // Agregar active al seleccionado
            this.classList.add("active");
            document.getElementById(tabId).classList.add("active");
          });
        });

        // Manejo de archivos - Revista
        document
          .getElementById("issue-cover-input")
          .addEventListener("change", function (e) {
            if (this.files.length > 0) {
              issueCoverFile = this.files[0];
              showImagePreview(this, "issue-cover-preview");
            }
          });

        document
          .getElementById("issue-pdf-input")
          .addEventListener("change", function (e) {
            if (this.files.length > 0) {
              issuePdfFile = this.files[0];
              document.getElementById(
                "pdf-file-name"
              ).textContent = `Archivo seleccionado: ${issuePdfFile.name}`;
            }
          });

        // Manejo de archivos - Nota
        document
          .getElementById("note-image-input")
          .addEventListener("change", function (e) {
            if (this.files.length > 0) {
              noteImageFile = this.files[0];
              showImagePreview(this, "note-image-preview");
            }
          });

        // Manejo de archivos - Editar Revista
        document
          .getElementById("edit-issue-cover-input")
          .addEventListener("change", function (e) {
            if (this.files.length > 0) {
              editIssueCoverFile = this.files[0];
              showImagePreview(this, "edit-issue-cover-preview");
            }
          });

        // Agregar revista
        document
          .getElementById("add-issue-btn")
          .addEventListener("click", agregarRevista);

        // Agregar categoría
        document
          .getElementById("add-category-btn")
          .addEventListener("click", agregarCategoria);

        // Agregar nota
        document
          .getElementById("add-note-btn")
          .addEventListener("click", agregarNota);

        // Guardar edición revista
        document
          .getElementById("save-edit-btn")
          .addEventListener("click", guardarEdicionRevista);

        // Imagen nueva en editar nota → vista previa
        document
          .getElementById("edit-note-image-input")
          .addEventListener("change", function () {
            if (this.files.length > 0) {
              editNoteImageFile = this.files[0];

              const preview = document.getElementById(
                "edit-note-image-preview"
              );
              preview.src = URL.createObjectURL(editNoteImageFile);
              preview.style.display = "block";
            }
          });

        // Guardar edición nota
        document
          .getElementById("save-note-btn")
          .addEventListener("click", guardarEdicionNota);

        // Cerrar modales
        document
          .getElementById("close-edit-modal")
          .addEventListener("click", cerrarModalEdicion);

        document
          .getElementById("close-note-modal")
          .addEventListener("click", cerrarModalNota);

        // Cerrar modal al hacer clic fuera
        document
          .getElementById("edit-issue-modal")
          .addEventListener("click", (e) => {
            if (e.target === document.getElementById("edit-issue-modal")) {
              cerrarModalEdicion();
            }
          });

        document
          .getElementById("edit-note-modal")
          .addEventListener("click", (e) => {
            if (e.target === document.getElementById("edit-note-modal")) {
              cerrarModalNota();
            }
          });

        // Hacer clic en las áreas de archivo
        document.querySelectorAll(".file-input").forEach((label) => {
          label.addEventListener("click", function (e) {
            const inputId = this.getAttribute("for");
            if (inputId) {
              document.getElementById(inputId).click();
            }
          });
        });
      }

      // ============================================
      // INICIALIZAR APLICACIÓN
      // ============================================

      document.addEventListener("DOMContentLoaded", initApp);

      // Funciones globales
      window.marcarComoActual = function (id) {
        // Quitar "actual" de todas las revistas
        revistas.forEach((revista) => {
          revista.isCurrent = revista.id === id;
        });

        // Actualizar interfaz
        cargarRevistas();

        // Mostrar confirmación
        const revista = revistas.find((r) => r.id === id);
        if (revista) {
          alert(`⭐ Revista N° ${revista.number} marcada como actual`);
        }
      };

      window.verRevista = verRevista;
      window.editarRevista = editarRevista;
      window.eliminarRevista = eliminarRevista;
      window.verNota = verNota;
      window.editarNota = editarNota;
      window.eliminarNota = eliminarNota;
      window.editarCategoria = editarCategoria;
      window.eliminarCategoria = eliminarCategoria;

      // Función para exportar datos (útil para debug)
      function exportarDatos() {
        console.log("📊 Datos actuales:", { revistas, categorias, notas });
        alert(
          `Total de revistas: ${revistas.length}\nTotal de notas: ${notas.length}\nTotal de categorías: ${categorias.length}`
        );
      }

      // Atajos de teclado
      document.addEventListener("keydown", (e) => {
        // Ctrl+E para exportar datos
        if (e.ctrlKey && e.key === "e") {
          e.preventDefault();
          exportarDatos();
        }
      });
    </script>
  </body>
</html>
